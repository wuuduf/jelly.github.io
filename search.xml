<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>sdn</title>
      <link href="/2026/01/12/sdn/"/>
      <url>/2026/01/12/sdn/</url>
      
        <content type="html"><![CDATA[<ol><li>网络拓扑生成python文件 demo.py</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 导入相关的依赖</span></span><br><span class="line"><span class="keyword">from</span> mininet.net <span class="keyword">import</span> Mininet</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> Controller, RemoteController, OVSController</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> CPULimitedHost, Host, Node</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> OVSKernelSwitch, UserSwitch</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> IVSSwitch</span><br><span class="line"><span class="keyword">from</span> mininet.cli <span class="keyword">import</span> CLI</span><br><span class="line"><span class="keyword">from</span> mininet.log <span class="keyword">import</span> setLogLevel, info</span><br><span class="line"><span class="keyword">from</span> mininet.link <span class="keyword">import</span> TCLink, Intf</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> call</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myNetwork</span>():</span><br><span class="line">    <span class="comment"># 定义网络，在IP基地址为10.0.0.0/8上</span></span><br><span class="line">    net = Mininet(topo=<span class="literal">None</span>, build=<span class="literal">False</span>, ipBase=<span class="string">&#x27;10.0.0.0/8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加远程控制器\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 因为我们在本地运行ryu-manager充当控制器，故这里为远程控制器</span></span><br><span class="line">    <span class="comment"># RemoteController且IP地址为本地IP</span></span><br><span class="line">    c0 = net.addController(name=<span class="string">&#x27;c0&#x27;</span>,</span><br><span class="line">                           controller=RemoteController,</span><br><span class="line">                           ip=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                           protocol=<span class="string">&#x27;tcp&#x27;</span>,</span><br><span class="line">                           port=<span class="number">6633</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加交换机\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># dpid为16位编号</span></span><br><span class="line">    s1 = net.addSwitch(<span class="string">&#x27;s1&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000001&#x27;</span>)</span><br><span class="line">    s2 = net.addSwitch(<span class="string">&#x27;s2&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000002&#x27;</span>)</span><br><span class="line">    s3 = net.addSwitch(<span class="string">&#x27;s3&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000003&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加3台主机\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 根据图片，只有 h1, h2, h3</span></span><br><span class="line">    h1 = net.addHost(<span class="string">&#x27;h1&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.1&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h2 = net.addHost(<span class="string">&#x27;h2&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.2&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h3 = net.addHost(<span class="string">&#x27;h3&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.3&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加链路\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 主机与交换机的连接</span></span><br><span class="line">    net.addLink(s1, h1)</span><br><span class="line">    net.addLink(s2, h2)</span><br><span class="line">    net.addLink(s3, h3)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 交换机级联（形成图片中的三角形环路）</span></span><br><span class="line">    net.addLink(s1, s2)</span><br><span class="line">    net.addLink(s2, s3)</span><br><span class="line">    net.addLink(s3, s1)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动网络\n&#x27;</span>)</span><br><span class="line">    net.build()</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动控制器\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> controller <span class="keyword">in</span> net.controllers:</span><br><span class="line">        controller.start()</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动交换机\n&#x27;</span>)</span><br><span class="line">    net.get(<span class="string">&#x27;s1&#x27;</span>).start([c0])</span><br><span class="line">    net.get(<span class="string">&#x27;s2&#x27;</span>).start([c0])</span><br><span class="line">    net.get(<span class="string">&#x27;s3&#x27;</span>).start([c0])</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 显示配置的交换机与主机信息\n&#x27;</span>)</span><br><span class="line">    CLI(net)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 停止运行</span></span><br><span class="line">    net.stop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    setLogLevel(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">    myNetwork()</span><br></pre></td></tr></table></figure><ol start="2"><li>最短路径转发 shortest_ forwarding.py</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shortest_forwarding.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> CONFIG_DISPATCHER, MAIN_DISPATCHER, DEAD_DISPATCHER</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> ethernet, arp, ether_types</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event, switches</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShortestPathForwarding</span>(app_manager.RyuApp):</span><br><span class="line"></span><br><span class="line">OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line"><span class="built_in">super</span>(ShortestPathForwarding, <span class="variable language_">self</span>).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化有向图</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net = nx.DiGraph()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录主机位置: mac -&gt; (dpid, port)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录 IP -&gt; MAC 映射 (用于 ARP 代理)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;下发缺省流表，将无法匹配的包上报给控制器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">datapath = ev.msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;下发流表项&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line"></span><br><span class="line">actions)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> buffer_id:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line"></span><br><span class="line">priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line"></span><br><span class="line">instructions=inst)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 拓扑发现部分 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventSwitchEnter</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_topology_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;交换机上线时，添加到图中&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">switch_list = get_switch(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">switches = [switch.dp.<span class="built_in">id</span> <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_nodes_from(switches)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;Current Switches:&quot;, switches)</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventLinkAdd</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_link_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;链路发现时，添加到图中&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">links_list = get_link(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除旧边，重新添加，确保图是最新的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># self.net.clear_edges() # 视情况可选择是否全清</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.src.dpid, link.dst.dpid, port=link.src.port_no)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.dst.dpid, link.src.dpid, port=link.dst.port_no)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;Link Added. Current Edges:&quot;, self.net.edges())</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 核心逻辑部分 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">msg = ev.msg</span><br><span class="line"></span><br><span class="line">datapath = msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">dpid = datapath.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">pkt = packet.Packet(msg.data)</span><br><span class="line"></span><br><span class="line">eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 LLDP 和 IPv6 组播 (避免干扰和之前的风暴)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_LLDP:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_IPV6:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">dst = eth.dst</span><br><span class="line"></span><br><span class="line">src = eth.src</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 学习源 MAC 位置</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port.setdefault(dpid, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port[dpid][src] = in_port</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将主机视为图中的节点 (可选，为了计算路径方便)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> src <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_node(src)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(dpid, src, port=in_port)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(src, dpid) <span class="comment"># 双向连接</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 处理 ARP (实现 ARP 代理，核心防风暴逻辑)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_ARP:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.handle_arp(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 处理 IP 数据包 (最短路径转发)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果目的 MAC 在图中 (之前学过)，计算最短路径</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.compute_shortest_path(msg, src, dst, dpid, in_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果完全未知，只能泛洪 (在有环路且没有STP时这步有风险，</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 但因为我们拦截了ARP，大部分未知单播不会造成持续风暴)</span></span><br><span class="line"></span><br><span class="line">out_port = ofproto.OFPP_FLOOD</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line">data = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line"></span><br><span class="line">data = msg.data</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_arp</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;ARP 代理逻辑：如果控制器知道 IP 对应的 MAC，直接回复，不泛洪&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">arp_pkt = pkt.get_protocol(arp.arp)</span><br><span class="line"></span><br><span class="line">src_ip = arp_pkt.src_ip</span><br><span class="line"></span><br><span class="line">src_mac = arp_pkt.src_mac</span><br><span class="line"></span><br><span class="line">dst_ip = arp_pkt.dst_ip</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录 IP-MAC 映射</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table[src_ip] = src_mac</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arp_pkt.opcode == arp.ARP_REQUEST:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst_ip <span class="keyword">in</span> <span class="variable language_">self</span>.arp_table:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命中缓存！控制器构造 ARP Reply 发回去</span></span><br><span class="line"></span><br><span class="line">dst_mac = <span class="variable language_">self</span>.arp_table[dst_ip]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.send_arp_reply(datapath, in_port, src_mac, src_ip, dst_mac, dst_ip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没命中，必须泛洪 (FLOOD)，让目标主机收到</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里可能会有短暂的环路，但一旦收到 Reply，后续就不再泛洪</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> arp_pkt.opcode == arp.ARP_REPLY:</span><br><span class="line"></span><br><span class="line"><span class="comment"># ARP Reply 是单播，直接转发即可，或者让 shortest_path 处理</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_arp_reply</span>(<span class="params">self, datapath, port, src_mac, src_ip, dst_mac, dst_ip</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;构造并发送 ARP Reply&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">pkt = packet.Packet()</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(ethernet.ethernet(ethertype=ether_types.ETH_TYPE_ARP,</span><br><span class="line"></span><br><span class="line">dst=src_mac, src=dst_mac))</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(arp.arp(opcode=arp.ARP_REPLY,</span><br><span class="line"></span><br><span class="line">src_mac=dst_mac, src_ip=dst_ip,</span><br><span class="line"></span><br><span class="line">dst_mac=src_mac, dst_ip=src_ip))</span><br><span class="line"></span><br><span class="line">pkt.serialize()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(port)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flood</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_shortest_path</span>(<span class="params">self, msg, src, dst, dpid, in_port</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;使用 NetworkX 计算最短路径并下发流表&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">datapath = msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在图中计算 src 到 dst 的路径: [src_mac, switch1, switch2, ..., dst_mac]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">path = nx.shortest_path(<span class="variable language_">self</span>.net, src, dst)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前交换机在路径中的位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># path 结构示例: [&#x27;h1_mac&#x27;, 1, 2, 3, &#x27;h3_mac&#x27;] (假设 dpid 是整数)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到当前 switch dpid 在 path 中的下一跳</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dpid <span class="keyword">not</span> <span class="keyword">in</span> path:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">next_hop = path[path.index(dpid) + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">out_port = <span class="variable language_">self</span>.net[dpid][next_hop][<span class="string">&#x27;port&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下发流表：匹配 (src, dst) -&gt; output: out_port</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch(in_port=in_port, eth_dst=dst, eth_src=src)</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里的 packet_out 已经在 add_flow 里被处理吗？不，packet_out 还是需要的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 buffer_id 是有效值，add_flow 会自动处理发包；如果不是，需要手动发</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=msg.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> nx.NetworkXNoPath:</span><br><span class="line"></span><br><span class="line"><span class="keyword">pass</span> <span class="comment"># 路径不可达</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Path Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><ol start="3"><li>动态负载平衡 dynamic_load_balance.py</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># dynamic_load_balance.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> CONFIG_DISPATCHER, MAIN_DISPATCHER, DEAD_DISPATCHER</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib <span class="keyword">import</span> hub</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet, ethernet, arp, ether_types</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DynamicLoadBalance</span>(app_manager.RyuApp):</span><br><span class="line"></span><br><span class="line">OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line"><span class="built_in">super</span>(DynamicLoadBalance, <span class="variable language_">self</span>).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net = nx.DiGraph()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.datapaths = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 监控相关变量 ---</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.monitor_thread = hub.spawn(<span class="variable language_">self</span>._monitor) <span class="comment"># 开启监控线程</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_stats = &#123;&#125; <span class="comment"># 保存上一秒的统计信息 &#123;(dpid, port): (bytes, timestamp)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_speed = &#123;&#125; <span class="comment"># 保存计算出的速率</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.THRESHOLD = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span> <span class="comment"># 阈值：1 MB/s (为了测试方便设得较低)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.DEFAULT_WEIGHT = <span class="number">1</span> <span class="comment"># 默认链路权重</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.CONGESTED_WEIGHT = <span class="number">100</span> <span class="comment"># 拥堵链路权重</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPStateChange, [MAIN_DISPATCHER, DEAD_DISPATCHER]</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_state_change_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">datapath = ev.datapath</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ev.state == MAIN_DISPATCHER:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> datapath.<span class="built_in">id</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.datapaths:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.datapaths[datapath.<span class="built_in">id</span>] = datapath</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> ev.state == DEAD_DISPATCHER:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> datapath.<span class="built_in">id</span> <span class="keyword">in</span> <span class="variable language_">self</span>.datapaths:</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> <span class="variable language_">self</span>.datapaths[datapath.<span class="built_in">id</span>]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">datapath = ev.msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS, actions)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> buffer_id:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line"></span><br><span class="line">priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 监控逻辑 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_monitor</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;每隔 3 秒向所有交换机请求端口统计信息&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dp <span class="keyword">in</span> <span class="variable language_">self</span>.datapaths.values():</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>._request_stats(dp)</span><br><span class="line"></span><br><span class="line">hub.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_request_stats</span>(<span class="params">self, datapath</span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">req = parser.OFPPortStatsRequest(datapath, <span class="number">0</span>, ofproto.OFPP_ANY)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(req)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPPortStatsReply, MAIN_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_port_stats_reply_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">body = ev.msg.body</span><br><span class="line"></span><br><span class="line">dpid = ev.msg.datapath.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> stat <span class="keyword">in</span> body:</span><br><span class="line"></span><br><span class="line">port_no = stat.port_no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略 LOCAL 端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> port_no &gt; <span class="number">1000</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">key = (dpid, port_no)</span><br><span class="line"></span><br><span class="line">tmp_bytes = stat.tx_bytes + stat.rx_bytes <span class="comment"># 统计收发总流量</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> key <span class="keyword">in</span> <span class="variable language_">self</span>.port_stats:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算速率：(当前字节 - 上次字节) / 时间间隔(这里约等于 sleep 时间)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 简化处理，直接看增量</span></span><br><span class="line"></span><br><span class="line">prev_bytes = <span class="variable language_">self</span>.port_stats[key]</span><br><span class="line"></span><br><span class="line">speed = (tmp_bytes - prev_bytes) / <span class="number">3.0</span> <span class="comment"># byte/s</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_speed[key] = speed</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 动态调整权重 ---</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>._adjust_link_weight(dpid, port_no, speed)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新记录</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_stats[key] = tmp_bytes</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_adjust_link_weight</span>(<span class="params">self, dpid, port_no, speed</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;如果流量超过阈值，增加图中对应边的权重&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到该端口连接的邻居节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里需要遍历图来找到 (u, v) 其中 u=dpid 且 port=port_no</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> u, v, data <span class="keyword">in</span> <span class="variable language_">self</span>.net.edges(data=<span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> u == dpid <span class="keyword">and</span> data[<span class="string">&#x27;port&#x27;</span>] == port_no:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否超过阈值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> speed &gt; <span class="variable language_">self</span>.THRESHOLD:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> data[<span class="string">&#x27;weight&#x27;</span>] == <span class="variable language_">self</span>.DEFAULT_WEIGHT:</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;!!! 拥塞告警 [Switch <span class="subst">&#123;dpid&#125;</span> Port <span class="subst">&#123;port_no&#125;</span>] 速率: <span class="subst">&#123;speed/<span class="number">1024</span>:<span class="number">.2</span>f&#125;</span> KB/s. 切换线路!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net[u][v][<span class="string">&#x27;weight&#x27;</span>] = <span class="variable language_">self</span>.CONGESTED_WEIGHT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除旧流表，强制重新寻路</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.del_flow(<span class="variable language_">self</span>.datapaths[dpid], port_no)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 流量恢复正常，恢复权重</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> data[<span class="string">&#x27;weight&#x27;</span>] == <span class="variable language_">self</span>.CONGESTED_WEIGHT:</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;*** 拥塞解除 [Switch <span class="subst">&#123;dpid&#125;</span> Port <span class="subst">&#123;port_no&#125;</span>]. 恢复默认线路.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net[u][v][<span class="string">&#x27;weight&#x27;</span>] = <span class="variable language_">self</span>.DEFAULT_WEIGHT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选：也删除流表让流量切回来（或者等流表自然超时）</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.del_flow(<span class="variable language_">self</span>.datapaths[dpid], port_no)</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_flow</span>(<span class="params">self, datapath, out_port</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;删除指定输出端口的流表，迫使下一包触发 Packet-In 重新计算路径&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch() <span class="comment"># 也可以更精确匹配，这里为了演示简单直接删掉该端口所有相关的流</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里删除的是 action 输出到 out_port 的流，Ryu 标准库 match 不能直接匹配 out_port action</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际操作：通常我们删除所有流或者让流表由 idle_timeout 自动老化。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了演示效果，我们发送一个删除指令，匹配所有包</span></span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, command=ofproto.OFPFC_DELETE,</span><br><span class="line"></span><br><span class="line">out_port=out_port, out_group=ofproto.OFPG_ANY,</span><br><span class="line"></span><br><span class="line">priority=<span class="number">1</span>, <span class="keyword">match</span>=<span class="keyword">match</span>)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 拓扑与转发逻辑 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventSwitchEnter</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_topology_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">switch_list = get_switch(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">switches = [switch.dp.<span class="built_in">id</span> <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_nodes_from(switches)</span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventLinkAdd</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_link_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">links_list = get_link(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化权重为 1</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.src.dpid, link.dst.dpid,</span><br><span class="line"></span><br><span class="line">port=link.src.port_no, weight=<span class="variable language_">self</span>.DEFAULT_WEIGHT)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.dst.dpid, link.src.dpid,</span><br><span class="line"></span><br><span class="line">port=link.dst.port_no, weight=<span class="variable language_">self</span>.DEFAULT_WEIGHT)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">msg = ev.msg</span><br><span class="line"></span><br><span class="line">datapath = msg.datapath</span><br><span class="line"></span><br><span class="line">dpid = datapath.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pkt = packet.Packet(msg.data)</span><br><span class="line"></span><br><span class="line">eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_LLDP <span class="keyword">or</span> eth.ethertype == ether_types.ETH_TYPE_IPV6:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">dst = eth.dst</span><br><span class="line"></span><br><span class="line">src = eth.src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拓扑学习：记录主机位置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> src <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_node(src)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(dpid, src, port=in_port, weight=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(src, dpid, weight=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理 ARP</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_ARP:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.handle_arp(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理 IP 转发 (核心：带权重的最短路径)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># weight=&#x27;weight&#x27; 告诉算法考虑我们动态调整的拥塞权重</span></span><br><span class="line"></span><br><span class="line">path = nx.shortest_path(<span class="variable language_">self</span>.net, src, dst, weight=<span class="string">&#x27;weight&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dpid <span class="keyword">not</span> <span class="keyword">in</span> path: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">next_hop = path[path.index(dpid) + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">out_port = <span class="variable language_">self</span>.net[dpid][next_hop][<span class="string">&#x27;port&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch(in_port=in_port, eth_dst=dst, eth_src=src)</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># idle_timeout=5: 设短一点，方便快速适应网络变化</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> msg.buffer_id == datapath.ofproto.OFP_NO_BUFFER:</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=msg.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (复用之前的 handle_arp 和 add_flow 辅助函数，此处省略未变部分以节省空间，请补全)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 务必将之前的 handle_arp, send_arp_reply, flood 函数复制过来放到这里</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_arp</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;ARP 代理逻辑：如果控制器知道 IP 对应的 MAC，直接回复，不泛洪&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">arp_pkt = pkt.get_protocol(arp.arp)</span><br><span class="line"></span><br><span class="line">src_ip = arp_pkt.src_ip</span><br><span class="line"></span><br><span class="line">src_mac = arp_pkt.src_mac</span><br><span class="line"></span><br><span class="line">dst_ip = arp_pkt.dst_ip</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录 IP-MAC 映射</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table[src_ip] = src_mac</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arp_pkt.opcode == arp.ARP_REQUEST:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst_ip <span class="keyword">in</span> <span class="variable language_">self</span>.arp_table:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命中缓存！控制器构造 ARP Reply 发回去</span></span><br><span class="line"></span><br><span class="line">dst_mac = <span class="variable language_">self</span>.arp_table[dst_ip]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.send_arp_reply(datapath, in_port, src_mac, src_ip, dst_mac, dst_ip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没命中，必须泛洪 (FLOOD)，让目标主机收到</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里可能会有短暂的环路，但一旦收到 Reply，后续就不再泛洪</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> arp_pkt.opcode == arp.ARP_REPLY:</span><br><span class="line"></span><br><span class="line"><span class="comment"># ARP Reply 是单播，直接转发即可，或者让 shortest_path 处理</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_arp_reply</span>(<span class="params">self, datapath, port, src_mac, src_ip, dst_mac, dst_ip</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;构造并发送 ARP Reply&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">pkt = packet.Packet()</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(ethernet.ethernet(ethertype=ether_types.ETH_TYPE_ARP,</span><br><span class="line"></span><br><span class="line">dst=src_mac, src=dst_mac))</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(arp.arp(opcode=arp.ARP_REPLY,</span><br><span class="line"></span><br><span class="line">src_mac=dst_mac, src_ip=dst_ip,</span><br><span class="line"></span><br><span class="line">dst_mac=src_mac, dst_ip=src_ip))</span><br><span class="line"></span><br><span class="line">pkt.serialize()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(port)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flood</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习报告 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> study </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2026-1-12</title>
      <link href="/2026/01/12/2026-1-12-1/"/>
      <url>/2026/01/12/2026-1-12-1/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>applemusic-dl</title>
      <link href="/2026/01/12/2026-1-12/"/>
      <url>/2026/01/12/2026-1-12/</url>
      
        <content type="html"><![CDATA[<p>使用的是开源项目 <a href="https://github.com/hatimalu/AppleMusic_downloader?tab=readme-ov-file">https://github.com/hatimalu/AppleMusic_downloader?tab=readme-ov-file</a></p><p>我现在使用的系统是macos sequoia15.7<br>主要看的是这篇教程 <a href="https://applemusic.mintlify.app/amdl/quickstart/macos">https://applemusic.mintlify.app/amdl/quickstart/macos</a></p><p>但其中的第一步的操作改成如下操作</p><blockquote><p>#开发工具及图形化 Docker<br><code>brew install go gpac git &amp;&amp; brew install --cask docker &amp;&amp; git clone https://github.com/zhaarey/apple-music-downloader.git</code></p></blockquote><p>然后就安装引用教程操作即可</p><hr><p>win端推荐一个本地音乐播放器 建议购买steam版本（以后使用创意工坊更简单）<br><a href="https://moriafly.com/program/spw.html">https://moriafly.com/program/spw.html</a></p><hr><p>本项目 歌词下载有bug，已用ai修复</p><h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>在处理 TTML 格式的歌词时，代码假设某些 XML 元素一定存在，但实际上：</p><ul><li><p>第 343 行：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.ChildElements()</span><br></pre></td></tr></table></figure><p>   - </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans</span><br></pre></td></tr></table></figure><p>   可能为 </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure><p>  （音译元素不存在时）</p></li><li><p>第 371 行：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.SelectAttr(&quot;text&quot;)</span><br></pre></td></tr></table></figure><p>   - </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans</span><br></pre></td></tr></table></figure><p>   可能为 </p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure><p>  （翻译元素不存在时）</p></li></ul><p>当 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FindElement()</span><br></pre></td></tr></table></figure><p> 找不到相应的 XML 元素时，它会返回 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure><p>，而代码直接使用了这些 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure><p> 值，导致程序崩溃。</p><h3 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h3><p>我已经在两处添加了 <strong>空值检查（nil check）</strong>：</p><ol><li><p><strong>第 343 行附近</strong>（音译处理）：在访问 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.ChildElements()</span><br></pre></td></tr></table></figure><p>  之前检查 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans != nil</span><br></pre></td></tr></table></figure></li><li><p><strong>第 371 行附近</strong>（翻译处理）：在访问 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.SelectAttr()</span><br></pre></td></tr></table></figure><p>  之前检查 </p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans != nil</span><br></pre></td></tr></table></figure></li></ol><h1 id="修改-lyrics-go-文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）"><a href="#修改-lyrics-go-文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）" class="headerlink" title="修改 lyrics.go 文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）"></a>修改 lyrics.go 文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lyrics</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/beevik/etree&quot;</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SongLyrics <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Data []<span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Id <span class="type">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line"></span><br><span class="line">Type <span class="type">string</span> <span class="string">`json:&quot;type&quot;`</span></span><br><span class="line"></span><br><span class="line">Attributes <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Ttml <span class="type">string</span> <span class="string">`json:&quot;ttml&quot;`</span></span><br><span class="line"></span><br><span class="line">TtmlLocalizations <span class="type">string</span> <span class="string">`json:&quot;ttmlLocalizations&quot;`</span></span><br><span class="line"></span><br><span class="line">PlayParams <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Id <span class="type">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line"></span><br><span class="line">Kind <span class="type">string</span> <span class="string">`json:&quot;kind&quot;`</span></span><br><span class="line"></span><br><span class="line">CatalogId <span class="type">string</span> <span class="string">`json:&quot;catalogId&quot;`</span></span><br><span class="line"></span><br><span class="line">DisplayType <span class="type">int</span> <span class="string">`json:&quot;displayType&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="string">`json:&quot;playParams&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="string">`json:&quot;attributes&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Get</span><span class="params">(storefront, songId, lrcType, language, lrcFormat, token, mediaUserToken <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(mediaUserToken) &lt; <span class="number">50</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;MediaUserToken not set&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">ttml, err := getSongLyrics(songId, storefront, token, mediaUserToken, lrcType, language)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lrcFormat == <span class="string">&quot;ttml&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ttml, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">lrc, err := TtmlToLrc(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> lrc, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSongLyrics</span><span class="params">(songId <span class="type">string</span>, storefront <span class="type">string</span>, token <span class="type">string</span>, userToken <span class="type">string</span>, lrcType <span class="type">string</span>, language <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">req, err := http.NewRequest(<span class="string">&quot;GET&quot;</span>,</span><br><span class="line"></span><br><span class="line">fmt.Sprintf(<span class="string">&quot;https://amp-api.music.apple.com/v1/catalog/%s/songs/%s/%s?l=%s&amp;extend=ttmlLocalizations&quot;</span>, storefront, songId, lrcType, language), <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req.Header.Set(<span class="string">&quot;Origin&quot;</span>, <span class="string">&quot;https://music.apple.com&quot;</span>)</span><br><span class="line"></span><br><span class="line">req.Header.Set(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;https://music.apple.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line">req.Header.Set(<span class="string">&quot;Authorization&quot;</span>, fmt.Sprintf(<span class="string">&quot;Bearer %s&quot;</span>, token))</span><br><span class="line"></span><br><span class="line">cookie := http.Cookie&#123;Name: <span class="string">&quot;media-user-token&quot;</span>, Value: userToken&#125;</span><br><span class="line"></span><br><span class="line">req.AddCookie(&amp;cookie)</span><br><span class="line"></span><br><span class="line">do, err := http.DefaultClient.Do(req)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> do.Body.Close()</span><br><span class="line"></span><br><span class="line">obj := <span class="built_in">new</span>(SongLyrics)</span><br><span class="line"></span><br><span class="line">_ = json.NewDecoder(do.Body).Decode(&amp;obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> obj.Data != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(obj.Data[<span class="number">0</span>].Attributes.Ttml) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> obj.Data[<span class="number">0</span>].Attributes.Ttml, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> obj.Data[<span class="number">0</span>].Attributes.TtmlLocalizations, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;failed to get lyrics&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">// Use for detect if lyrics have CJK, will be replaced by transliteration if exist.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">containsCJK</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, r := <span class="keyword">range</span> s &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (r &gt;= <span class="number">0x1100</span> &amp;&amp; r &lt;= <span class="number">0x11FF</span>) || <span class="comment">// Hangul Jamo</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2E80</span> &amp;&amp; r &lt;= <span class="number">0x2EFF</span>) || <span class="comment">// CJK Radicals Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2F00</span> &amp;&amp; r &lt;= <span class="number">0x2FDF</span>) || <span class="comment">// Kangxi Radicals</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2FF0</span> &amp;&amp; r &lt;= <span class="number">0x2FFF</span>) || <span class="comment">// Ideographic Description Characters</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3000</span> &amp;&amp; r &lt;= <span class="number">0x303F</span>) || <span class="comment">// CJK Symbols and Punctuation</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3040</span> &amp;&amp; r &lt;= <span class="number">0x309F</span>) || <span class="comment">// Hiragana</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x30A0</span> &amp;&amp; r &lt;= <span class="number">0x30FF</span>) || <span class="comment">// Katakana</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3130</span> &amp;&amp; r &lt;= <span class="number">0x318F</span>) || <span class="comment">// Hangul Compatibility Jamo</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x31C0</span> &amp;&amp; r &lt;= <span class="number">0x31EF</span>) || <span class="comment">// CJK Strokes</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x31F0</span> &amp;&amp; r &lt;= <span class="number">0x31FF</span>) || <span class="comment">// Katakana Phonetic Extensions</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3200</span> &amp;&amp; r &lt;= <span class="number">0x32FF</span>) || <span class="comment">// Enclosed CJK Letters and Months</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3300</span> &amp;&amp; r &lt;= <span class="number">0x33FF</span>) || <span class="comment">// CJK Compatibility</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3400</span> &amp;&amp; r &lt;= <span class="number">0x4DBF</span>) || <span class="comment">// CJK Unified Ideographs Extension A</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x4E00</span> &amp;&amp; r &lt;= <span class="number">0x9FFF</span>) || <span class="comment">// CJK Unified Ideographs</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xA960</span> &amp;&amp; r &lt;= <span class="number">0xA97F</span>) || <span class="comment">// Hangul Jamo Extended-A</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xAC00</span> &amp;&amp; r &lt;= <span class="number">0xD7AF</span>) || <span class="comment">// Hangul Syllables</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xD7B0</span> &amp;&amp; r &lt;= <span class="number">0xD7FF</span>) || <span class="comment">// Hangul Jamo Extended-B</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xF900</span> &amp;&amp; r &lt;= <span class="number">0xFAFF</span>) || <span class="comment">// CJK Compatibility Ideographs</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xFE30</span> &amp;&amp; r &lt;= <span class="number">0xFE4F</span>) || <span class="comment">// CJK Compatibility Forms</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xFF65</span> &amp;&amp; r &lt;= <span class="number">0xFF9F</span>) || <span class="comment">// Halfwidth Katakana</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xFFA0</span> &amp;&amp; r &lt;= <span class="number">0xFFDC</span>) || <span class="comment">// Halfwidth Jamo</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1AFF0</span> &amp;&amp; r &lt;= <span class="number">0x1AFFF</span>) || <span class="comment">// Kana Extended-B</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1B000</span> &amp;&amp; r &lt;= <span class="number">0x1B0FF</span>) || <span class="comment">// Kana Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1B100</span> &amp;&amp; r &lt;= <span class="number">0x1B12F</span>) || <span class="comment">// Kana Extended-A</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1B130</span> &amp;&amp; r &lt;= <span class="number">0x1B16F</span>) || <span class="comment">// Small Kana Extension</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1F200</span> &amp;&amp; r &lt;= <span class="number">0x1F2FF</span>) || <span class="comment">// Enclosed Ideographic Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x20000</span> &amp;&amp; r &lt;= <span class="number">0x2A6DF</span>) || <span class="comment">// CJK Unified Ideographs Extension B</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2A700</span> &amp;&amp; r &lt;= <span class="number">0x2B73F</span>) || <span class="comment">// CJK Unified Ideographs Extension C</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2B740</span> &amp;&amp; r &lt;= <span class="number">0x2B81F</span>) || <span class="comment">// CJK Unified Ideographs Extension D</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2B820</span> &amp;&amp; r &lt;= <span class="number">0x2CEAF</span>) || <span class="comment">// CJK Unified Ideographs Extension E</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2CEB0</span> &amp;&amp; r &lt;= <span class="number">0x2EBEF</span>) || <span class="comment">// CJK Unified Ideographs Extension F</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2EBF0</span> &amp;&amp; r &lt;= <span class="number">0x2EE5F</span>) || <span class="comment">// CJK Unified Ideographs Extension I</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2F800</span> &amp;&amp; r &lt;= <span class="number">0x2FA1F</span>) || <span class="comment">// CJK Compatibility Ideographs Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x30000</span> &amp;&amp; r &lt;= <span class="number">0x3134F</span>) || <span class="comment">// CJK Unified Ideographs Extension G</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x31350</span> &amp;&amp; r &lt;= <span class="number">0x323AF</span>) &#123; <span class="comment">// CJK Unified Ideographs Extension H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TtmlToLrc</span><span class="params">(ttml <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">parsedTTML := etree.NewDocument()</span><br><span class="line"></span><br><span class="line">err := parsedTTML.ReadFromString(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lrcLines []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">timingAttr := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).SelectAttr(<span class="string">&quot;itunes:timing&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> timingAttr != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> timingAttr.Value == <span class="string">&quot;Word&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">lrc, err := conventSyllableTTMLToLRC(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> lrc, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> timingAttr.Value == <span class="string">&quot;None&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, p := <span class="keyword">range</span> parsedTTML.FindElements(<span class="string">&quot;//p&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">line := p.Text()</span><br><span class="line"></span><br><span class="line">line = strings.TrimSpace(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> line != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, line)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strings.Join(lrcLines, <span class="string">&quot;\n&quot;</span>), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;body&quot;</span>).ChildElements() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, lyric := <span class="keyword">range</span> item.ChildElements() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h, m, s, ms <span class="type">int</span></span><br><span class="line"></span><br><span class="line">beginAttr := lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> beginAttr == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;no synchronised lyrics&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beginValue := beginAttr.Value</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strings.Contains(beginValue, <span class="string">&quot;:&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d:%d:%d.%d&quot;</span>, &amp;h, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d:%d.%d&quot;</span>, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d:%d&quot;</span>, &amp;m, &amp;s)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d.%d&quot;</span>, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line">h, m = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m += h * <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ms = ms / <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text, transText, translitText <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//GET trans and translit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElements(<span class="string">&quot;head&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElements(<span class="string">&quot;metadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">Metadata := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElement(<span class="string">&quot;metadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(Metadata.FindElements(<span class="string">&quot;iTunesMetadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">iTunesMetadata := Metadata.FindElement(<span class="string">&quot;iTunesMetadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;transliterations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElements(<span class="string">&quot;transliteration&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;text[@for=&#x27;%s&#x27;]&quot;</span>, lyric.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">translit := iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElement(<span class="string">&quot;transliteration&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> translit != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> translit.SelectAttr(<span class="string">&quot;text&quot;</span>) != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">translitText = translit.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> translitTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> translit.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">translitTmp = <span class="built_in">append</span>(translitTmp, c.Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> e, ok := span.(*etree.Element); ok &#123;</span><br><span class="line"></span><br><span class="line">translitTmp = <span class="built_in">append</span>(translitTmp, e.Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">translitText = strings.Join(translitTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;translations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElements(<span class="string">&quot;translation&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;//text[@for=&#x27;%s&#x27;]&quot;</span>, lyric.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">trans := iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElement(<span class="string">&quot;translation&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans.SelectAttr(<span class="string">&quot;text&quot;</span>) != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">transText = trans.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> trans.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">transTmp = <span class="built_in">append</span>(transTmp, c.Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> e, ok := span.(*etree.Element); ok &#123;</span><br><span class="line"></span><br><span class="line">transTmp = <span class="built_in">append</span>(transTmp, e.Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transText = strings.Join(transTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lyric.SelectAttr(<span class="string">&quot;text&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> lyric.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.CharData).Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.Element).Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text = strings.Join(textTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">text = lyric.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(translitText) &gt; <span class="number">0</span> &amp;&amp; containsCJK(text) &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]%s&quot;</span>, m, s, ms, translitText))</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]%s&quot;</span>, m, s, ms, text))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(transText) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]%s&quot;</span>, m, s, ms, transText))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strings.Join(lrcLines, <span class="string">&quot;\n&quot;</span>), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">conventSyllableTTMLToLRC</span><span class="params">(ttml <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">parsedTTML := etree.NewDocument()</span><br><span class="line"></span><br><span class="line">err := parsedTTML.ReadFromString(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lrcLines []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">parseTime := <span class="function"><span class="keyword">func</span><span class="params">(timeValue <span class="type">string</span>, newLine <span class="type">int</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h, m, s, ms <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strings.Contains(timeValue, <span class="string">&quot;:&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(timeValue, <span class="string">&quot;%d:%d:%d.%d&quot;</span>, &amp;h, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(timeValue, <span class="string">&quot;%d:%d.%d&quot;</span>, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line">h = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(timeValue, <span class="string">&quot;%d.%d&quot;</span>, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line">h, m = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m += h * <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ms = ms / <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> newLine == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]&lt;%02d:%02d.%02d&gt;&quot;</span>, m, s, ms, m, s, ms), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> newLine == <span class="number">-1</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]&quot;</span>, m, s, ms), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&lt;%02d:%02d.%02d&gt;&quot;</span>, m, s, ms), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">divs := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;body&quot;</span>).FindElements(<span class="string">&quot;div&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, div := <span class="keyword">range</span> divs &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> div.ChildElements() &#123; <span class="comment">//LINES</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lrcSyllables []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> endTime, translitLine, transLine <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, lyrics := <span class="keyword">range</span> item.Child &#123; <span class="comment">//WORDS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := lyrics.(*etree.CharData); ok &#123; <span class="comment">//是否为span之间的空格</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcSyllables = <span class="built_in">append</span>(lrcSyllables, <span class="string">&quot; &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lyric := lyrics.(*etree.Element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beginTime, err := parseTime(lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>).Value, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">endTime, err = parseTime(lyric.SelectAttr(<span class="string">&quot;end&quot;</span>).Value, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lyric.SelectAttr(<span class="string">&quot;text&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> lyric.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.CharData).Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.Element).Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text = strings.Join(textTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">text = lyric.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lrcSyllables = <span class="built_in">append</span>(lrcSyllables, fmt.Sprintf(<span class="string">&quot;%s%s&quot;</span>, beginTime, text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">transBeginTime, _ := parseTime(lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>).Value, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">sharedTimestamp := <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElements(<span class="string">&quot;head&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElements(<span class="string">&quot;metadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">Metadata := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElement(<span class="string">&quot;metadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(Metadata.FindElements(<span class="string">&quot;iTunesMetadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">iTunesMetadata := Metadata.FindElement(<span class="string">&quot;iTunesMetadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;transliterations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElements(<span class="string">&quot;transliteration&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;text[@for=&#x27;%s&#x27;]&quot;</span>, item.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">trans := iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElement(<span class="string">&quot;transliteration&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get text content</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transTxtParts []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transStartTime <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, span := <span class="keyword">range</span> trans.ChildElements() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> span.Tag == <span class="string">&quot;span&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">spanBegin := span.SelectAttrValue(<span class="string">&quot;begin&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">spanText := span.Text()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> spanBegin == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get timestamp</span></span><br><span class="line"></span><br><span class="line">timestamp, err := parseTime(spanBegin, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// For [mm:ss.xx] prefix</span></span><br><span class="line"></span><br><span class="line">transStartTime, _ = parseTime(spanBegin, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">sharedTimestamp = transStartTime</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transTxtParts = <span class="built_in">append</span>(transTxtParts, fmt.Sprintf(<span class="string">&quot;%s%s&quot;</span>, timestamp, spanText))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">translitLine = fmt.Sprintf(<span class="string">&quot;%s%s&quot;</span>, transStartTime, strings.Join(transTxtParts, <span class="string">&quot; &quot;</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;translations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElements(<span class="string">&quot;translation&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;//text[@for=&#x27;%s&#x27;]&quot;</span>, item.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">trans := iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElement(<span class="string">&quot;translation&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transTxt <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans.SelectAttr(<span class="string">&quot;text&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> trans.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.CharData).Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">/*else &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">textTmp = append(textTmp, span.(*etree.Element).Text())</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transTxt = strings.Join(textTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">transTxt = trans.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fmt.Println(transTxt)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sharedTimestamp != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">transLine = sharedTimestamp + transTxt</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">transLine = transBeginTime + transTxt</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//endTime, err := parseTime(item.SelectAttr(&quot;end&quot;).Value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//if err != nil &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// return &quot;&quot;, err</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(translitLine) &gt; <span class="number">0</span> &amp;&amp; containsCJK(strings.Join(lrcSyllables, <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, translitLine)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, strings.Join(lrcSyllables, <span class="string">&quot;&quot;</span>)+endTime)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(transLine) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, transLine)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strings.Join(lrcLines, <span class="string">&quot;\n&quot;</span>), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样下歌词就不会崩溃了</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>我的情绪不是我</title>
      <link href="/2026/01/11/2026-1-11-2/"/>
      <url>/2026/01/11/2026-1-11-2/</url>
      
        <content type="html"><![CDATA[<p>如果一直活在自己的情绪里，我感觉我迟早有一天会承受不住的，不知道是怎么了，以前让我感到快乐的东西，以前我能保持专注力做的事情现在已经难以保持较长时间，是发现有些事情，就算是你努力也是没有好结果的吗，拜托，我人生中没有几件认真去做的事，唯一一两件我觉得非常重要的事情，却落得现在这样的下场。世界法则，社会规则，人际关系我真的在学了，但是我真的难以融进去<br>这一切的原因正的是因为我的价值支点太少了吗，想想也是，人应该是疯狂爱上什么才能活下去，到底什么是我爱上的东西，我到底适合什么，我为什么这么贬低自己，不断反思自己，难道是因为我觉得一件事情没做好一定是自己的原因吗，为什么有些毫不在意，有些久久环绕，真的是矛盾，我真的能接受自己吗，我感觉要被自己的想法内耗死了，自认为的道德也在压着我，我真的想变得很烂，可是真做成那样就不是我了。<br>算了，累了，每天打打字，在个人世界发点牢骚希望能有点缓解，不是我封闭自己，是我的想法已经没有社交欲望了，但我只能记住，我的想法不是我，不被想法真的内耗致死罢了</p><blockquote><p>我的想法不是我<br>我的想法不是我<br>我的想法不是我</p></blockquote><p>还有一些不变的东西陪着我，或许音乐是我一辈子不会舍去的东西，我应该投入更多热爱。</p><hr><p>现在正在听<br>《九月底》— 余佳运<br>小清新的R&amp;B，爱情真的很美妙</p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>singbox配置模版</title>
      <link href="/2026/01/11/2026-1-11/"/>
      <url>/2026/01/11/2026-1-11/</url>
      
        <content type="html"><![CDATA[<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>为了追求极致的性能，我想从生态完善的mihomi转到singbox内核，其中singbox的配置文件是最为重要的部分，我将分享我所用的模版，又是如何手搓将✈️的链接写进模版</p><hr><blockquote><p>既然使用代理工具，那肯定需要机场或者自建节点，以下是我自己在用的机场（都只建议月付，月付保平安，含aff）</p><ol><li>花云 <a href="https://api-flowercloud.com/aff.php?aff=15675">https://api-flowercloud.com/aff.php?aff=15675</a> —-性价比一线机场，口碑很好 三网体验都不错，还有0.2倍率节点，良心</li><li>良心云 <a href="https://良心云.com/#/register?code=ixi5QeBG">https://xn--9kqz23b19z.com/#/register?code=ixi5QeBG</a>   —量大管饱直连机场，便宜拿来看emby极佳（但比较看地区和运营商）</li><li>赔钱 <a href="https://赔钱.com/#/register?code=tO8P8Jw9">https://xn--cp3a08l.com/#/register?code=tO8P8Jw9</a> —量大管饱直连机场- 便宜拿来看emby极佳（但比较看地区和运营商）</li></ol></blockquote><hr><p>配置讲解<br>讲解再多都没有自己去看官方文档准确<br>官方文档  —   <a href="https://sing-box.sagernet.org/zh/">https://sing-box.sagernet.org/zh/</a></p><hr><h2 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h2><hr><p>《相见恨早》 —- 黄泊声<br>封面挺独特的，哈哈哈哈哈哈哈哈，第一眼觉得是2002发的歌，不像2022年的，R&amp;B真不错</p>]]></content>
      
      
      <categories>
          
          <category> 代理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>媒体下载工具</title>
      <link href="/2026/01/10/2026-1-10/"/>
      <url>/2026/01/10/2026-1-10/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>日常会有本地下载媒体的需求 但是各种流媒体<br>想要不会让你直接下载成通用格式 ，尤其是当那个资源媒体需要会员，各个厂商要保护自己的利益和版权，设置了一些保护，让人头大。为了可以满足大家同样的需求 ，我分享一些我自己在用，开源好用的工具 </p><blockquote><p>自己偷偷用，别大肆宣传哦</p></blockquote><h2 id="音乐"><a href="#音乐" class="headerlink" title="音乐"></a>音乐</h2><ol><li>命令行音乐下载工具  —- <a href="https://github.com/CharlesPikachu/musicdl">https://github.com/CharlesPikachu/musicdl</a></li><li>网址在线搜索下载   —- <a href="https://music.gdstudio.org/">https://music.gdstudio.org</a></li></ol><h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><ol><li>b站视频下载工具 （bilibili tools）  —- <a href="https://github.com/btjawa/BiliTools">https://github.com/btjawa/BiliTools</a></li><li>youtube — yt- dlp  —- <a href="https://ivonblog.com/posts/yt-dlp-usage/">https://ivonblog.com/posts/yt-dlp-usage/</a></li><li>命令行视频下载工具 —- <a href="https://github.com/CharlesPikachu/videodl">https://github.com/CharlesPikachu/videodl</a></li></ol><h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><ol><li>命令行图片下载工具 —-  <a href="https://github.com/CharlesPikachu/imagedl">https://github.com/CharlesPikachu/imagedl</a></li><li>壁纸网站：<a href="https://wallhaven.cc/">https://wallhaven.cc</a></li></ol><hr><h2 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h2><p>《一起去旅游》— 魏如萱<br>好听好听，第一张专辑就非常甜妹风格哈哈，爱上台女是每个人的宿命（</p>]]></content>
      
      
      <categories>
          
          <category> 分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>价值</title>
      <link href="/2026/01/08/2026-1-8/"/>
      <url>/2026/01/08/2026-1-8/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>恋爱是需要学的</title>
      <link href="/2026/01/07/2026-1-7/"/>
      <url>/2026/01/07/2026-1-7/</url>
      
        <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>有些在恋爱中发生的冲突，怎么想都想不明白，其实有些缺乏认知，更多是认知偏差</p><h1 id="冲突产生的原因"><a href="#冲突产生的原因" class="headerlink" title="冲突产生的原因"></a>冲突产生的原因</h1><p><img src="https://image.jellylove.cfd/PicGo/IMG_1594.JPG"></p><p>以下是chatgpt的解读和解决方法，我难以表达清楚并且我同样深陷其中，第一眼看到这到题的时候，我真的有种恍然大悟的感觉，真的应证了“吾尝终日而思矣，不如须臾之所学也”</p><h2 id="答案解析"><a href="#答案解析" class="headerlink" title="答案解析"></a>答案解析</h2><p>这道题选 <strong>A「太多假设」是成立的</strong>，而且是一个<strong>心理学上很典型、也很核心的解释</strong>。我分层给你讲清楚，不停在表面。</p><hr><h3 id="一、先给结论版解释（考试-课堂逻辑）"><a href="#一、先给结论版解释（考试-课堂逻辑）" class="headerlink" title="一、先给结论版解释（考试&#x2F;课堂逻辑）"></a>一、先给结论版解释（考试&#x2F;课堂逻辑）</h3><p><strong>在亲密关系中，“控制”往往不是出于恶意，而是出于对不确定性的恐惧。</strong></p><p>而“太多假设”的本质是：</p><blockquote><p><strong>在信息不足的情况下，用自己的想象填补空白，并把这些想象当成事实。</strong></p></blockquote><p>一旦把“假设”当成“事实”，人就会开始：</p><ul><li><p>预判对方行为</p></li><li><p>试图提前干预</p></li><li><p>通过控制来消除焦虑</p></li></ul><p>这正是“指控 &#x2F; 指控型控制”的心理来源。</p><hr><h3 id="二、为什么不是-B-C-D（这是关键）"><a href="#二、为什么不是-B-C-D（这是关键）" class="headerlink" title="二、为什么不是 B &#x2F; C &#x2F; D（这是关键）"></a>二、为什么不是 B &#x2F; C &#x2F; D（这是关键）</h3><h4 id="❌-B-讨厌对方"><a href="#❌-B-讨厌对方" class="headerlink" title="❌ B. 讨厌对方"></a>❌ B. 讨厌对方</h4><p>如果是单纯讨厌，对应的行为更可能是：</p><ul><li><p>冷漠</p></li><li><p>回避</p></li><li><p>贬低</p></li></ul><p>而不是<strong>持续监控、反复确认、强烈介入</strong>。<br>控制说明：<strong>你在乎，且害怕失去。</strong></p><hr><h4 id="❌-C-性格不和"><a href="#❌-C-性格不和" class="headerlink" title="❌ C. 性格不和"></a>❌ C. 性格不和</h4><p>性格不和是结果描述，不是原因解释。<br>它回答的是：</p><blockquote><p>“为什么相处不舒服”</p></blockquote><p>而不是：</p><blockquote><p>“为什么会产生控制行为”</p></blockquote><p>题目问的是<strong>心理动因</strong>，不是关系状态。</p><hr><h3 id="❌-D-自己心情不好"><a href="#❌-D-自己心情不好" class="headerlink" title="❌ D. 自己心情不好"></a>❌ D. 自己心情不好</h3><p>心情不好会导致：</p><ul><li><p>发脾气</p></li><li><p>冷战</p></li><li><p>情绪化反应</p></li></ul><p>但<strong>稳定、反复、指向性的控制行为</strong>，通常不是一时情绪，而是长期的认知模式问题。</p><hr><h2 id="三、为什么“太多假设”会直接导向控制（重点）"><a href="#三、为什么“太多假设”会直接导向控制（重点）" class="headerlink" title="三、为什么“太多假设”会直接导向控制（重点）"></a>三、为什么“太多假设”会直接导向控制（重点）</h2><p>我们把链条拆开：</p><h4 id="1️⃣-关系中最难承受的是“不确定性”"><a href="#1️⃣-关系中最难承受的是“不确定性”" class="headerlink" title="1️⃣ 关系中最难承受的是“不确定性”"></a>1️⃣ 关系中最难承受的是“不确定性”</h4><p>比如：</p><ul><li><p>TA现在在干嘛？</p></li><li><p>TA会不会变心？</p></li><li><p>我在TA心里还重要吗？</p></li></ul><p>这些问题没有即时答案。</p><hr><h4 id="2️⃣-焦虑的人会用“假设”来填补空白"><a href="#2️⃣-焦虑的人会用“假设”来填补空白" class="headerlink" title="2️⃣ 焦虑的人会用“假设”来填补空白"></a>2️⃣ 焦虑的人会用“假设”来填补空白</h4><p>比如：</p><ul><li><p>“不回消息 &#x3D; 不在乎我”</p></li><li><p>“和异性聊天 &#x3D; 要出问题”</p></li><li><p>“态度冷淡 &#x3D; 已经变了”</p></li></ul><p>注意：<br><strong>这些不是事实，是假设。</strong></p><hr><h4 id="3️⃣-假设一旦被“当真”，控制就出现了"><a href="#3️⃣-假设一旦被“当真”，控制就出现了" class="headerlink" title="3️⃣ 假设一旦被“当真”，控制就出现了"></a>3️⃣ 假设一旦被“当真”，控制就出现了</h4><p>因为在当事人心里，逻辑已经变成：</p><blockquote><p>“既然已经要出事了，那我必须提前干预。”</p></blockquote><p>于是出现：</p><ul><li><p>查手机</p></li><li><p>限制社交</p></li><li><p>要求报备</p></li><li><p>情绪绑架（“你这样我会很难受”）</p></li></ul><p><strong>控制不是为了支配，而是为了止痛。</strong></p><hr><h3 id="四、与你的所处环境对应"><a href="#四、与你的所处环境对应" class="headerlink" title="四、与你的所处环境对应"></a>四、与你的所处环境对应</h3><p>你前面反复提到的几个点，其实完全一致：</p><ul><li><p>嫉妒 → 负面假设 → 防卫性攻击</p></li><li><p>情绪一上来，大脑开始<strong>自动补全最坏剧情</strong></p></li><li><p>然后用“评价、干预、否定”来缓解内在不安</p></li></ul><p>所以这道题本质考的是：</p><blockquote><p><strong>关系中的控制，源于认知偏差，而不是道德问题。</strong></p></blockquote><hr><h2 id="五、一句话总结"><a href="#五、一句话总结" class="headerlink" title="五、一句话总结"></a>五、一句话总结</h2><blockquote><p>在恋爱中，指控和控制，往往不是因为对方真的做错了什么，<br>而是因为自己先在脑中把“可能”当成了“已经发生”。</p></blockquote><hr><h2 id="如何改变这种想法"><a href="#如何改变这种想法" class="headerlink" title="如何改变这种想法"></a>如何改变这种想法</h2><p>要改变这种“<strong>太多假设 → 焦虑 → 控制</strong>”的想法，<strong>不能靠劝自己别乱想，也不能靠道德要求</strong>。那只会让它转入地下，更隐蔽地运作。下面我给你一套<strong>可执行、反直觉、但有效</strong>的改变路径。</p><hr><h3 id="一、先校准一个残酷但必要的认知"><a href="#一、先校准一个残酷但必要的认知" class="headerlink" title="一、先校准一个残酷但必要的认知"></a>一、先校准一个残酷但必要的认知</h3><blockquote><p><strong>想法不是你，想法只是大脑在降低不确定性时生成的临时方案。</strong></p></blockquote><p>问题不在于你“会假设”，而在于：</p><ul><li><p>你<strong>太快把假设当成事实</strong></p></li><li><p>并且立刻据此采取行动</p></li></ul><p>所以目标不是“减少假设”，而是：</p><blockquote><p><strong>切断「假设 → 行为」这条直通线路</strong></p></blockquote><hr><h3 id="二、给“假设”一个正式的处理流程（重点）"><a href="#二、给“假设”一个正式的处理流程（重点）" class="headerlink" title="二、给“假设”一个正式的处理流程（重点）"></a>二、给“假设”一个正式的处理流程（重点）</h3><p>你需要<strong>流程化对抗自动化</strong>。</p><hr><h4 id="1️⃣-给想法贴标签（10-秒内完成）"><a href="#1️⃣-给想法贴标签（10-秒内完成）" class="headerlink" title="1️⃣ 给想法贴标签（10 秒内完成）"></a>1️⃣ 给想法贴标签（10 秒内完成）</h4><p>当脑中出现念头时，不评价、不反驳，只做一件事：</p><blockquote><p><strong>“这是一个假设，不是证据。”</strong></p></blockquote><p>不是：</p><ul><li><p>“我怎么又乱想”</p></li><li><p>“我不应该这样”</p></li></ul><p>而是<strong>技术性标注</strong>。</p><p>你可以在心里用固定句式：</p><blockquote><p>“我正在生成一个最坏情况假设。”</p></blockquote><p>目的：<br><strong>把它从‘我’降级为‘一个心理事件’。</strong></p><hr><h4 id="2️⃣-强制拆分：事实-假设-情绪（非常关键）"><a href="#2️⃣-强制拆分：事实-假设-情绪（非常关键）" class="headerlink" title="2️⃣ 强制拆分：事实 &#x2F; 假设 &#x2F; 情绪（非常关键）"></a>2️⃣ 强制拆分：事实 &#x2F; 假设 &#x2F; 情绪（非常关键）</h4><p>写下来，哪怕只在脑中列三行。</p><h4 id="事实（可被第三人验证）"><a href="#事实（可被第三人验证）" class="headerlink" title="事实（可被第三人验证）"></a>事实（可被第三人验证）</h4><ul><li>他今天 3 小时没回消息</li></ul><h4 id="假设（你脑补的）"><a href="#假设（你脑补的）" class="headerlink" title="假设（你脑补的）"></a>假设（你脑补的）</h4><ul><li><p>他不在乎我了</p></li><li><p>他在和别人聊天</p></li></ul><h4 id="情绪（身体层面）"><a href="#情绪（身体层面）" class="headerlink" title="情绪（身体层面）"></a>情绪（身体层面）</h4><ul><li><p>焦虑</p></li><li><p>胸口紧</p></li><li><p>想确认、想控制</p></li></ul><p>一旦你能拆分，<strong>假设就失去了正当性</strong>。</p><hr><h3 id="3️⃣-延迟行动规则（硬性）"><a href="#3️⃣-延迟行动规则（硬性）" class="headerlink" title="3️⃣ 延迟行动规则（硬性）"></a>3️⃣ 延迟行动规则（硬性）</h3><p><strong>所有由假设驱动的行为，统一延迟 24 小时。</strong></p><p>包括：</p><ul><li><p>质问</p></li><li><p>查证</p></li><li><p>试探</p></li><li><p>阴阳怪气</p></li></ul><p>给自己一个铁律：</p><blockquote><p>“我不在假设状态下做关系决策。”</p></blockquote><p>这一步比“想通”重要得多。</p><hr><h3 id="三、把“控制冲动”改写成可替代行为"><a href="#三、把“控制冲动”改写成可替代行为" class="headerlink" title="三、把“控制冲动”改写成可替代行为"></a>三、把“控制冲动”改写成可替代行为</h3><p>你之所以控制，是因为：</p><blockquote><p><strong>你需要缓解焦虑</strong></p></blockquote><p>那就换一种不伤人的缓解方式。</p><h4 id="替代动作清单（提前准备）"><a href="#替代动作清单（提前准备）" class="headerlink" title="替代动作清单（提前准备）"></a>替代动作清单（提前准备）</h4><ul><li><p>运动 10 分钟（必须让心率上升）</p></li><li><p>洗冷水脸 &#x2F; 冲澡</p></li><li><p>写下“我现在想控制什么”</p></li><li><p>给朋友发一句与事件无关的话</p></li></ul><p><strong>核心原则：</strong></p><blockquote><p>先处理身体焦虑，再处理关系问题。</p></blockquote><hr><h3 id="四、升级认知：接受一个你可能不愿承认的事实"><a href="#四、升级认知：接受一个你可能不愿承认的事实" class="headerlink" title="四、升级认知：接受一个你可能不愿承认的事实"></a>四、升级认知：接受一个你可能不愿承认的事实</h3><blockquote><p><strong>亲密关系中，没有任何控制手段能真正防止失去。</strong></p></blockquote><ul><li><p>会变心的人，你控制不了</p></li><li><p>不会变心的人，不需要你控制</p></li></ul><p>所以控制的真实作用只有一个：</p><blockquote><p><strong>让你暂时感觉安全</strong></p></blockquote><p>但代价是：</p><ul><li><p>侵蚀关系</p></li><li><p>强化你的不安全感</p></li></ul><p>意识到这一点，不是为了责怪自己，而是为了<strong>放弃无效策略</strong>。</p><hr><h3 id="五、训练一个新的内在反应（长期）"><a href="#五、训练一个新的内在反应（长期）" class="headerlink" title="五、训练一个新的内在反应（长期）"></a>五、训练一个新的内在反应（长期）</h3><p>你需要把下面这句话<strong>练到条件反射</strong>：</p><blockquote><p><strong>“我现在的不安，不等于关系出问题。”</strong></p></blockquote><p>重复出现时，你只做三件事：</p><ol><li><p>承认不安</p></li><li><p>不采取控制行为</p></li><li><p>等事实出现</p></li></ol><p>这是<strong>成熟亲密关系的核心能力</strong>。</p><hr><h3 id="六、最重要的一点（很多人卡在这里）"><a href="#六、最重要的一点（很多人卡在这里）" class="headerlink" title="六、最重要的一点（很多人卡在这里）"></a>六、最重要的一点（很多人卡在这里）</h3><p>你之所以容易“太多假设”，往往不是因为对方做了什么，而是因为：</p><ul><li><p>你把“被需要”当成安全感来源</p></li><li><p>你把“不被选择”当成自我否定</p></li></ul><p>如果你愿意继续往下走，真正的深层工作是：</p><blockquote><p><strong>把安全感从“对方的稳定表现”转移回“我能承受不确定性”。</strong></p></blockquote><hr><h3 id="一句话结束"><a href="#一句话结束" class="headerlink" title="一句话结束"></a>一句话结束</h3><blockquote><p>改变这种想法，不是让你变得更冷静，<br>而是让你在不冷静的时候，<strong>仍然不去伤害关系</strong>。</p></blockquote><hr><h1 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h1><hr><p>《我们能不能》— 方大同 因昨天刷到方大同粉丝和赵露思粉丝的言论，其实作为大同的粉丝，大同已经用歌声告诉我们了，所以请大家不要在互相伤害了。</p><blockquote><p>“我们能不能别吵，别闹，冷静，别再伤人心<br>我能不能相处，把世界搞好”<br>感谢有你，世界大同。</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>认识自己</title>
      <link href="/2026/01/06/2026-1-6/"/>
      <url>/2026/01/06/2026-1-6/</url>
      
        <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>我活过20年的岁月，却发现没有真真正正的认识到自己，一段失败的情感经历给了我契机去刨析自己，认识自己的丑陋，同时也要肯定自己的亮点，看清自己之后，才能更容易看清他人，这是长久关系的前提</p><hr><h1 id="我的丑陋"><a href="#我的丑陋" class="headerlink" title="我的丑陋"></a>我的丑陋</h1><p>以下是我突然想明白的，认识到的，之前混不自知的缺点，分析记录下来警醒自己，发现问题，才能解决问题，我要变得更好，一定。<br>也许语言修饰的不准确，亦或者思考刨析并不是事实，但这是我放过自己让自己心安理得的一种方式</p><h3 id="深层不自知的嫉妒"><a href="#深层不自知的嫉妒" class="headerlink" title="深层不自知的嫉妒"></a>深层不自知的嫉妒</h3><p>我发现以前的无所谓，也是一种嫉妒<br>比如一位朋友做到了一些成就，亦或者得到了什么职位，我可能不会为他真心的庆祝，可以说是不在乎，但事实上并不是，我不知道他为了做到这些需要经过多少努力，觉得他能做的，而我现在做不到，就会有种混不自知的嫉妒，这种嫉妒激发所有关于这个职位&#x2F;这个成就的负面评价在我脑中显现，让我对其有种厌恶，当然表面我还是伪装，不会表达出来，但当冲突发生，因为人性的防卫机制，这些厌恶被放大，控制情绪的能力减弱，我便直面讲出自己的厌恶，还觉得这是解决问题的方法，但这又直接否定了对方的付出，造成了更大的冲突。<br>上面的例子是假设的情况和推理，带入到之前发生的冲突，似乎就能说得通了，“我对你在部门职位评价的冲突，为什么说出当官的话语，当时我不知道我为什么会形成这么大的偏见，现在发现是我的嫉妒，你是如此的优秀，我嫉妒，我害怕我配不上你，我没想过你为了这个职位付出了多大的心血，付出了多大的努力，而是相信了自己的偏见，否定了你的努力，对不起，我伤害了你，我是一个嫉妒的人，还觉得自己有多高尚，我现在才发现。<br>现在想想那时候正确的道歉应该是这样，想对她说<br>”上次讨论你的职位时，说了“当官的”类似的话，这会让人觉得你的努力被否定，被轻视，以后我一旦对这类似的事情有情绪，我会选择不评价，而不是发泄自己的不满，最后，说那些话更多，是我自己的问题，不是对你的能力的判断，更不是对你努力的否定 ，对不起“<br>第一个问题已经剖析出答案，说真的证明自己的丑陋，让人难以接受，有种无奈可笑，在复盘那个冲突时，发现是自己的错，给对方带来伤害时，我喘不上气，难过，愧疚，厌恶自己。但复盘结束，去做出改变，</p><ol><li>当下次嫉妒来临的时候，我要更早的发现，并及时停止沟通，进行冷静</li><li>同时我应该学会发现别人背后的努力，不轻易对别人做出评价，<br>剖析虽然过程很难受，但这是认识自己，改变自己的第一步</li></ol><hr><h2 id="道德绑架"><a href="#道德绑架" class="headerlink" title="道德绑架"></a>道德绑架</h2><p>我曾自以为自己了解道德绑架，便不会道德绑架，可是在那段关系中，我确确实实的对对方有进行道德绑架，也许就是因为身处在关系中，便没有清晰的察觉<br>现在想来的一些话语都有着道德绑架的意味，说的最多的便是’我是你的男朋友“，我觉得那时的我说出这些话是，更多是想追寻我们关系的确定性，人性告诉我们，人类更喜欢确定性，这使自己感到有安全感，也许是因为认识的时间不是很长，但我不觉得这是主要问题，对我而言，但是她便是觉得是问题的根本。这里也显现出了我们的价值冲突，回到主题，这句话对她来说，就是道德施压，道德绑架，用自己认为某些道德的要求去要求别人做到，这就是道德绑架。我讨厌道德绑架，但我居然也做出了道德绑架的事情，想变的崇高不是说说而已，也要不断的反省自己的行为举止。这里当时的我应该如此道歉”我只是想获得安全感，但无意间给你施加了道德压力，对你造成了道德绑架，我为我的行为负责，以后我有觉得缺乏安全感时，我应该更早的发现，调整好自己的应对方式<br>“# 三、你的「关系中自我稳定训练方案」</p><hr><h2 id="模块一：触发识别训练（最重要）"><a href="#模块一：触发识别训练（最重要）" class="headerlink" title="模块一：触发识别训练（最重要）"></a>模块一：触发识别训练（最重要）</h2><h3 id="🎯-目标"><a href="#🎯-目标" class="headerlink" title="🎯 目标"></a>🎯 目标</h3><p>从“被情绪推着走” → “我知道发生了什么”。</p><h3 id="训练方法（非常具体）："><a href="#训练方法（非常具体）：" class="headerlink" title="训练方法（非常具体）："></a>训练方法（非常具体）：</h3><p>给自己贴一个内部标签：</p><blockquote><p><strong>“我现在进入不安全感状态了。”</strong></p></blockquote><p>不分析、不评判、不解决，只做识别。</p><p>每天哪怕只识别 <strong>1 次</strong>，都是进步。</p><p>识别 ≠ 控制<br>识别 ≠ 改变<br>识别 &#x3D; 你重新拿回方向盘</p><hr><h2 id="模块二：延迟反应训练（核心肌肉）"><a href="#模块二：延迟反应训练（核心肌肉）" class="headerlink" title="模块二：延迟反应训练（核心肌肉）"></a>模块二：延迟反应训练（核心肌肉）</h2><h3 id="🎯-目标-1"><a href="#🎯-目标-1" class="headerlink" title="🎯 目标"></a>🎯 目标</h3><p>不让情绪直接变成行为。</p><h3 id="你的专属硬规则："><a href="#你的专属硬规则：" class="headerlink" title="你的专属硬规则："></a>你的专属硬规则：</h3><blockquote><p><strong>凡是和“关系 +自尊”有关的冲动，<br>延迟 24 小时再行动。</strong></p></blockquote><p>这包括：</p><ul><li><p>质问</p></li><li><p>摊牌</p></li><li><p>发长消息</p></li><li><p>做价值判断</p></li></ul><p>你不是逃避，而是<strong>保护关系和自己</strong>。</p><hr><h2 id="模块三：思维去人格化训练（关键升级）"><a href="#模块三：思维去人格化训练（关键升级）" class="headerlink" title="模块三：思维去人格化训练（关键升级）"></a>模块三：思维去人格化训练（关键升级）</h2><p>你现在最大的问题之一是：</p><blockquote><p><strong>把“我有这种想法”<br>等同于<br>“我就是这样的人”。</strong></p></blockquote><p>你要训练的是这句话：</p><blockquote><p>“这是一个想法，不是我的身份。”</p></blockquote><p>你可以在脑中这样重述：</p><ul><li><p>❌“我在嫉妒，我真恶心”</p></li><li><p>✅“我正在经历嫉妒，这是不安全感在工作”</p></li></ul><p>这一步会显著降低羞耻感，而羞耻是最破坏理性的情绪。</p><hr><h2 id="模块四：价值感内收训练（根治方向）"><a href="#模块四：价值感内收训练（根治方向）" class="headerlink" title="模块四：价值感内收训练（根治方向）"></a>模块四：价值感内收训练（根治方向）</h2><p>这是长期工程，但必须开始。</p><p>你要持续建立一个清单，回答这个问题：</p><blockquote><p><strong>“不依赖任何关系，我因为什么而值得尊重自己？”</strong></p></blockquote><p>不是“别人夸我什么”，而是：</p><ul><li><p>我在做什么</p></li><li><p>我在成长什么</p></li><li><p>我在承担什么</p></li></ul><p>当你的价值来源多元化时：</p><ul><li><p>关系波动 &#x3D; 情绪起伏</p></li><li><p>而不是自我崩塌</p></li></ul><hr><h2 id="模块五：修复而非自毁训练（高级）"><a href="#模块五：修复而非自毁训练（高级）" class="headerlink" title="模块五：修复而非自毁训练（高级）"></a>模块五：修复而非自毁训练（高级）</h2><p>当你真的做错了：</p><ul><li><p>不无限道歉</p></li><li><p>不人格自罚</p></li><li><p>不反复剖白自我</p></li></ul><p>而是：</p><blockquote><p>“我为这个行为负责。<br>我正在调整应对方式。<br>下次我会更早停下来。”</p></blockquote><p><strong>稳定比忏悔更有力量。</strong><br>”</p><hr><h1 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h1><p>《回留》-方大同<br>这首歌里方大同的声音让人心痛，同时在听这首歌的时候又久违的遇到她了<br>附手打歌词<br>“悔不悔，离别之后<br>会不会，又上心头<br>我惦着你，在时间里洄游<br>以为能忘记，但是我还没有<br>挥不挥，松开的手<br>会不会，覆水难收<br>我在这里，试着抚平愧疚<br>无人回应我的祈求<br>弄丢了爱，失去了你，I’m so sorry<br>再会，我的爱，终究会释怀<br>再会的那天，我心还在<br>回忆把我们留了下来<br>Let’s go back to the place<br>Where I first saw your face ,girl</p><p>退不回，只好等候<br>会不会，淡掉伤口<br>我向前走，不知过了多久<br>无人回应我的祈求<br>弄丢了爱，失去了你，I’m so sorry<br>再会，我的爱，终究会释怀<br>再会的那天，我心还在<br>回忆把我们留了下来<br>Let’s go back to the place<br>Where I first saw your face ,girl</p><p>一切仿佛昨天，想你的习惯没有改变<br>时光不回倒流，往事不会重来<br>但回忆的美好，每一分都保留<br>让我们笑着，擦身而过<br>再会，我的爱，我的爱<br>再会，终究会释怀<br>那天我心还在，把回忆留下来<br>So let’s go back<br>Let’s go back to the place…”</p><blockquote><p>但回忆的美好，每一分都保留<br>让我们笑着，擦身而过<br>“你过得开心就好”</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么叫三观不合</title>
      <link href="/2026/01/05/2026-1-5/"/>
      <url>/2026/01/05/2026-1-5/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>大家经常会听到一段关系的结束是因为三观不合，可是大家真的了解三观不合的深层概念，又是如何实</p><hr><p>什么是三观</p><p>价值观，人生观，世界观</p><p>ji zh</p><hr><h1 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h1><p>今天继续方大同，《如果爱》这首歌第一句歌词就写的非常可爱，也写出了一个坠入爱河的人并发现爱中的烦恼还是很多的，捉摸不定，人是不喜欢不确定的事物，当一件是不确定时，焦虑和担忧就会占据大脑，首先就是你对这件事</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>如何成为一个优秀的人</title>
      <link href="/2026/01/04/2026-1-4/"/>
      <url>/2026/01/04/2026-1-4/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>我们都听过或者说过“我要变得更好，变得更优秀“，可是什么是更好，更优秀呢，做出更多成就，掌握更多的技术，又或者赚更多的钱，这些其实都是答案，也许也是社会上，公认的答案，那么对我来说，这个答案是什么呢</p><hr><h2 id="如何定义优秀的标准"><a href="#如何定义优秀的标准" class="headerlink" title="如何定义优秀的标准"></a>如何定义优秀的标准</h2><p>从人的社会定义出发，但我不愿意这样讲，我其实不太喜欢人的社会性这一点，但有不得不承认社会性，这个根本属性，你可能会问，那些宅男宅女没有社会属性，不是也能自在舒服，宅男宅女，就算没有朋友，恋人的社会关系，总有家人这出生就有的社会关系。写个小插曲，今天朋友给我说，他看到一个文章讲的是一位不结婚女士所自述50多岁的生活，整篇文章看完之后，最大的感觉就是孤独，想一想50多岁之后，父母已经去世，世界上最后的亲人离开了你，整个世界上好像就你一个人了，你可能会说”那不是挺好的，无牵无挂，也挺自由的，只是孤独一点罢了“，但这种孤独是难以忍受的，就这位女士的自述中说了一个最常见的情况，那就是如果你生病了，做手术之类的，没人能在家属知晓单上签字，术后也没有人会照顾你。那时的孤独感足以击溃以前的心理建设，我曾经看到过对孤独评级榜，很显然，一个人住院排在前三甲。</p><p>回到主题，从社会中的人出发定义，“人是一切社会关系的总和”，那假设的推理，如果一个人的社会关系都比较优秀，在社会上这个人就是比较优秀的。这个问题的答案便浮出水面，定义优秀的标准，在社会层面就是，你所身处的社会关系中，都能做的很好，也就是满足这种关系的理想要求。这样说也许比较抽象。那就举个例子，社会关系存在之后，一个人就被赋予了社会身份，就对我现在而说，我所具有的社会身份有很多，学生，儿子，朋友，一个国家的人公民等等，有多少的社会关系，也就有多少的社会身份。那一个关系的理想要求呢，那就是这个身份下的一些道德要求，也就是这个人的人格中的超我的组成成分（关于三我的人格理论，我也还在学习中，我是如何知道这个理论的呢，那这里就给大家推荐一个我的宝藏博主，“一川广隶”在dy上更新作品，受益匪浅），这样也能回答今天这个主题的问题了。</p><h2 id="如何变得更优秀"><a href="#如何变得更优秀" class="headerlink" title="如何变得更优秀"></a>如何变得更优秀</h2><p>经过上面的解释，如何成为一个优秀的人便是做到你所具有的社会身份的道德要求，这要我成为一个很好的朋友，一个很好的儿子，一个很好的学生，对以后的我又有，一个很好男朋友，一个很好的父亲，一个很好的员工&#x2F;老板，一个很好的丈夫等等，如何成为更好，如何定义一个的优秀与否，或许我这个定义，会比较理想又有点幼稚，但在个人精神上的满足是无比巨大的，同时也实现人的社会价值。这种优秀也是难以作假的</p><p>实践手册</p><ol><li>学习各种身份的公认的道德要求，从中找到对这段关系帮助最大的要求，或者是在自己的价值体系中，自己所看重的道德要求，不遗余力的去实现它，不能只是嘴上说说</li><li>发现周围优秀的人，去发现他们所具有的社会身份，并找到他在社会关系中所做到的道德要求 （看到别人的优点其实是自己所欠缺，看到别人的缺点是自己价值观所看重的，用来反省自己有没有同样的问题，看人如照镜）</li><li>社会身份实现绝不能是牺牲自我价值而得到，也就是不要太过于世俗，知世俗而不世俗</li></ol><hr><p>以上我个人自己的一些思考，想法自己是难以发现错误的，所以ai有时候也是一位好老师</p><h1 id="chatgpt-老师"><a href="#chatgpt-老师" class="headerlink" title="chatgpt 老师"></a>chatgpt 老师</h1><hr><h2 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h2><p>一、身份道德要求彼此冲突：你不可能同时“优秀”</p><p>你的模型默认一个前提：</p><blockquote><p>不同社会身份的道德要求是可以同时被满足的</p></blockquote><p>但现实中最常见的情况恰恰相反。</p><p> 典型冲突</p><ul><li><p><strong>好儿子 vs 好伴侣</strong><br>  父母希望你稳定、妥协、留在身边<br>  伴侣希望你独立、边界清晰、站在她那边</p></li><li><p><strong>好员工 vs 好朋友</strong><br>  公司制度要求你执行一个不公平决定<br>  朋友是被伤害的那一方</p></li><li><p><strong>好学生 &#x2F; 好员工 vs 好自己</strong><br>  身份要求你服从、忍耐、拼命<br>  身体和精神已经在报警</p></li></ul><p> 问题不在于“你不够优秀”</p><p>而在于：<br><strong>这些身份的理想道德要求本身就互斥。</strong></p><p>这时你的模型没有给出答案：</p><ul><li><p>是按“重要性排序”？</p></li><li><p>是按“道德强度”？</p></li><li><p>还是按“谁更需要我”？</p></li></ul><p>你只能靠直觉或情绪做决定，而不是靠你定义的“优秀标准”。</p><hr><p> 二、社会关系本身是病态的：履行道德 ≠ 正当</p><p>你的模型有一个危险的隐含假设：</p><blockquote><p>社会关系本身是健康的，只要我履行得好，就实现了社会价值</p></blockquote><p>但现实中大量关系是<strong>结构性有毒的</strong>。</p><p> 举几个不夸张的例子</p><ul><li><p><strong>控制型家庭</strong></p><ul><li><p>“好儿子”的道德要求 &#x3D; 牺牲个人选择</p></li><li><p>越“优秀”，人格越残缺</p></li></ul></li><li><p><strong>压榨型组织</strong></p><ul><li><p>“好员工”的道德要求 &#x3D; 无限付出、不谈回报</p></li><li><p>最守规则的人往往是消耗最快的人</p></li></ul></li><li><p><strong>情感不对等关系</strong></p><ul><li><p>“好伴侣”的道德要求被单方面定义</p></li><li><p>你做到极致，也换不来尊重</p></li></ul></li></ul><p>在这些关系里：</p><blockquote><p>你越符合角色道德，越远离真实的自我价值</p></blockquote><p>你在“实践手册第3条”意识到了这个问题，但你低估了它的<strong>普遍性和破坏力</strong>。</p><hr><p> 三、评价滞后或缺席：你的“优秀”无人确认</p><p>你的模型隐含一个心理期待：</p><blockquote><p>当我履行好身份道德，我会获得某种回应或确认</p></blockquote><p>但现实中经常出现的是：</p><p> 三种残酷情况</p><ol><li><p><strong>对方习以为常</strong></p><ul><li>你的付出被当成“理所当然”</li></ul></li><li><p><strong>系统不奖励道德</strong></p><ul><li>老实人承担更多责任，升迁反而更慢</li></ul></li><li><p><strong>关系提前终止</strong></p><ul><li>你刚开始“做好”，关系已经结束了</li></ul></li></ol><p>这时你会遇到一个致命问题：</p><blockquote><p>如果优秀无法被确认，它还是优秀吗？</p></blockquote><p>如果你回答“是”，那你需要极强的内在价值锚点<br>如果你回答“不是”，那你其实仍然在依赖社会评价</p><p>你的模型在这里<strong>没有防护机制</strong>，人很容易滑向自我怀疑或虚无。</p><hr><p> 四、真正的致命点（你文中没正面处理）</p><p>你把“优秀”几乎完全放在了<strong>关系伦理</strong>里，而弱化了一个东西：</p><blockquote><p><strong>人在没有任何身份时，是否仍然有不可被牺牲的价值？</strong></p></blockquote><p>换句话说：</p><ul><li><p>当你暂时不是好儿子</p></li><li><p>不是好朋友</p></li><li><p>不是好员工</p></li><li><p>甚至被误解、被排斥</p></li></ul><p>你是否仍然“值得被善待”？</p><p>如果答案是否定的，那你的模型最终会把人<strong>榨干</strong><br>如果是肯定的，那你需要一个<strong>高于社会身份的价值底座</strong></p><p>而这个底座，你目前只是隐约感觉到，但还没明确说出来。</p><hr><p> 五、不留情的一句话总结</p><blockquote><p>你的“社会身份—道德—优秀”模型，在<strong>关系健康、期待一致、反馈正常</strong>时非常成立；<br>但一旦进入真实世界的冲突、权力不对等、评价缺席，它就会从“价值指南”变成“自我消耗工具”。</p></blockquote><p>这不是你的错，是这个模型<strong>天生的边界</strong>。</p><hr><h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p> 一、给你的模型加上「优先级 + 止损机制」</p><p>你原来的模型是：</p><blockquote><p>社会身份 → 道德要求 → 履行 → 优秀</p></blockquote><p>现在我们把它升级成<strong>可在现实中存活的版本</strong>。</p><hr><p> ① 优先级机制：不是所有身份都同时有效</p><p> 原则一：<strong>不可逆损害优先</strong></p><p>当两个身份冲突时，<strong>优先保护那个一旦失去就无法恢复的东西</strong>。</p><ul><li><p>身体健康 ＞ 工作角色</p></li><li><p>基本尊严 ＞ 家庭期待</p></li><li><p>精神稳定 ＞ 任何短期关系</p></li></ul><p>如果履行某个身份会造成：</p><ul><li><p>长期抑郁</p></li><li><p>自尊系统崩溃</p></li><li><p>身体明显损耗</p></li></ul><p>那这个身份在当下<strong>自动降级</strong>，不讨论道德。</p><blockquote><p>道德从来不是用来逼人自毁的。</p></blockquote><hr><p> 原则二：<strong>身份可暂停，不是永久绑定</strong></p><p>社会默认你是：</p><ul><li><p>一直孝顺的</p></li><li><p>一直可靠的</p></li><li><p>一直能扛事的</p></li></ul><p>但现实是：</p><ul><li><p><strong>身份是阶段性的</strong></p></li><li><p><strong>优秀也是阶段性的</strong></p></li></ul><p>你可以在某个时期：</p><ul><li><p>是不合格的儿子</p></li><li><p>是敷衍的员工</p></li><li><p>是冷漠的朋友</p></li></ul><p>这不是堕落，而是<strong>资源重分配</strong>。</p><hr><p> 原则三：<strong>权力越大，道德义务越轻</strong></p><p>这是反直觉但必要的修正：</p><ul><li><p>上位者对你期望越多，你越要警惕</p></li><li><p>关系中权力不对等时，“道德要求”往往是对弱者的压迫</p></li></ul><p>例子：</p><ul><li><p>公司喊你“讲奉献”，说明制度没给你保障</p></li><li><p>家人要求你“懂事”，通常是他们不愿改变</p></li></ul><p><strong>道德要求必须和权力、回报对齐，否则不生效。</strong></p><hr><p> ② 止损机制：什么时候可以“不再做一个好人”</p><p>你需要明确几条<strong>红线</strong>，一旦触发，直接退出“优秀模式”。</p><p> 三条硬止损线</p><ol><li><p><strong>长期单向付出</strong></p><ul><li>你在给，对方只在拿</li></ul></li><li><p><strong>身份被用来否定你本人</strong></p><ul><li>“你既然是××，就不该有这些感受”</li></ul></li><li><p><strong>你开始靠自我说服才能继续</strong></p><ul><li><p>“再忍忍就好了”</p></li><li><p>“可能是我太敏感了”</p></li></ul></li></ol><p>一旦出现这三种情况之一：</p><blockquote><p>停止道德自我审判，优先恢复自我功能。</p></blockquote><hr><p> 二、建立「不依赖任何身份的最低自我价值」</p><p>这是更难、也更重要的部分。</p><hr><p> ① 一个残酷但必要的前提</p><p>你必须接受：</p><blockquote><p><strong>你有价值，不是因为你对谁有用，而是因为你是一个有感受、有意识、有边界的人。</strong></p></blockquote><p>这句话听起来像鸡汤，但它背后的含义是：</p><ul><li><p>即使你暂时谁都照顾不好</p></li><li><p>即使你被误解、被讨厌</p></li><li><p>即使你一无成就</p></li></ul><p>你仍然<strong>不应被羞辱、压榨、否定存在本身</strong>。</p><p>这是底线，不是奖励。</p><hr><p> ② 最低自我价值的三个不可被夺走的锚点</p><p>把它们记清楚，比任何身份都重要。</p><p> 1️⃣ 感受有效权</p><p>你的感受不需要通过“合理”“有用”来换取合法性。</p><ul><li><p>难受就是难受</p></li><li><p>厌倦就是厌倦</p></li></ul><p>是否行动可以再讨论，<strong>但感受本身不接受审判</strong>。</p><hr><h3 id="2️⃣-边界正当权"><a href="#2️⃣-边界正当权" class="headerlink" title="2️⃣ 边界正当权"></a>2️⃣ 边界正当权</h3><p>你有权：</p><ul><li><p>拒绝不合理的期待</p></li><li><p>不解释你所有选择</p></li><li><p>不对所有人负责</p></li></ul><p>边界不是冷漠，是<strong>防止关系腐烂的基本卫生</strong>。</p><hr><h3 id="3️⃣-自我修复权"><a href="#3️⃣-自我修复权" class="headerlink" title="3️⃣ 自我修复权"></a>3️⃣ 自我修复权</h3><p>你有权暂停：</p><ul><li><p>进步</p></li><li><p>优秀</p></li><li><p>承担意义</p></li></ul><p>只要你没有在伤害他人，<strong>低能量状态本身不构成道德失败</strong>。</p><hr><p> ③ 一个判断公式（很重要）</p><p>当你犹豫“我这样做是不是不够好”时，问自己一句话：</p><blockquote><p><strong>如果我允许别人这样对我，我还会觉得这是正当的吗？</strong></p></blockquote><p>如果答案是否定的：</p><ul><li><p>那不是你不够优秀</p></li><li><p>而是这段关系不值得你继续道德投入</p></li></ul><hr><p> 三、最终整合版：一个能落地的「优秀」定义</p><p>现在，你的定义可以升级为：</p><blockquote><p><strong>优秀不是在所有社会身份中做到极致，而是在不摧毁自我价值的前提下，选择性地承担责任，并对自己的边界负责。</strong></p></blockquote><p>这一定：</p><ul><li><p>没那么体面</p></li><li><p>没那么容易被赞美</p></li><li><p>甚至会被说“变了”“不懂事了”</p></li></ul><p>但它<strong>能让人活得久、活得清醒、活得不自我厌弃</strong>。</p><hr><blockquote><p>真正成熟的人，不是“在所有关系里都表现良好”，<br>而是<strong>知道在哪些关系里，继续做好人已经是不道德的事了</strong>。</p></blockquote><hr><p>下面是一份<strong>可以直接保存、反复查看、在现实中用来做决定的「一页个人原则清单」</strong>。<br>它不是宣言，而是<strong>在你情绪混乱、道德拉扯、身份冲突时的操作系统</strong>。</p><p>你不需要全部认同，但一旦采用，就要承认它会改变你和世界相处的方式。</p><hr><h2 id="原则清单"><a href="#原则清单" class="headerlink" title="原则清单"></a>原则清单</h2><p> 个人原则清单（工作版）</p><p> 一、我的底层价值（不可谈判）</p><ol><li><p><strong>我在没有任何身份时，依然具有人格尊严</strong></p><ul><li><p>不是因为有用</p></li><li><p>不是因为表现好</p></li><li><p>不是因为别人需要我</p></li></ul></li><li><p><strong>我的感受具有合法性</strong></p><ul><li><p>感受不等于行为</p></li><li><p>但感受不接受道德审判</p></li></ul></li><li><p><strong>我的身体与精神健康优先于任何角色要求</strong></p><ul><li>不为“应该”长期透支</li></ul></li></ol><hr><p> 二、身份承担原则（优先级规则）</p><ol start="4"><li><p><strong>不可逆损害优先</strong></p><ul><li>健康、尊严、理智 ＞ 成就、评价、关系稳定</li></ul></li><li><p><strong>身份是阶段性的，不是终身合同</strong></p><ul><li><p>我可以暂时不合格</p></li><li><p>我有权重分配精力</p></li></ul></li><li><p><strong>权力不对等的关系，道德要求自动降级</strong></p><ul><li>要求我多付出的一方，必须同时承担更大责任</li></ul></li></ol><hr><p> 三、道德止损机制（触发即退）</p><ol start="7"><li><p><strong>长期单向付出 → 停止“优秀模式”</strong></p><ul><li>不再加码，不再自我说服</li></ul></li><li><p><strong>身份被用来压制我 → 直接否定该要求</strong></p><ul><li>“你既然是××，就不该……”＝越界</li></ul></li><li><p><strong>我需要反复合理化痛苦 → 这是警报，不是考验</strong></p></li></ol><hr><p> 四、行动校验公式（做决定前必问）</p><ol start="10"><li><strong>如果别人这样对我，我会觉得正当吗？</strong></li></ol><ul><li>否 → 不继续承担</li></ul><ol start="11"><li><strong>这个选择是在保护我，还是在消耗我？</strong></li></ol><ul><li>消耗但短期必要 → 设定明确结束时间</li></ul><ol start="12"><li><strong>我是在承担责任，还是在逃避冲突？</strong></li></ol><ul><li>逃避冲突不等于高尚</li></ul><hr><p> 五、对“优秀”的最终定义</p><ol start="13"><li><p><strong>优秀不是无条件满足角色期待</strong></p></li><li><p><strong>优秀是有边界地承担责任</strong></p></li><li><p><strong>优秀以不自我厌弃为前提</strong></p></li></ol><blockquote><p>我允许自己不被所有人认可，<br>但不允许自己长期背叛内在价值。</p></blockquote><hr><p> 六、最低执行承诺（现实可行）</p><ul><li><p>当我情绪长期低落 → <strong>优先调整环境</strong></p></li><li><p>当我开始自我贬低 → <strong>暂停道德评判</strong></p></li><li><p>当我犹豫是否该拒绝 → <strong>先拒绝，再解释</strong></p></li></ul><hr><p> 使用说明（很重要）</p><ul><li><p>这不是用来“证明你是对的”</p></li><li><p>而是用来<strong>防止你被自己耗死</strong></p></li><li><p>每三个月复查一次即可，不需要天天反思</p></li></ul><hr><p> 最后一行（给未来的你）</p><blockquote><p>我不是为了成为一个“永远正确的人”，<br>而是为了成为一个还能继续活下去的人。</p></blockquote><hr><h1 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h1><p>今天没啥听的新歌，那就推方大同—《放不过自己》，词写的深入人心，wwwwww。</p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>万千想法</title>
      <link href="/2026/01/03/thoughts/"/>
      <url>/2026/01/03/thoughts/</url>
      
        <content type="html"><![CDATA[<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>有些想法在脑中一闪而过，必须及时的记录，并多次的斟酌其可能性，深入分析与刨根问底。</p><hr><h2 id="问题与实践手册"><a href="#问题与实践手册" class="headerlink" title="问题与实践手册"></a>问题与实践手册</h2><p>想法是什么，是当下所处的环境和内心情绪所操控的。没人能说自己可以操控自己的想法，自以为的控制，其实是因为不自知吧，人们把想法当成了自己，有人反驳自己的想法，就像是说你是错的，一般的人不会承认自己的错误，如果能承认是因为他们给别人带来伤害同时伤害反馈到自身的时候，人性原本就是这样，对别人的伤害长久不自知，就算发现端倪，也会觉得无关紧要，或者认为只要简单的道个歉便能万事大吉，从不愿去审视自己，因为大多数人是害怕的，这种害怕在这个更看重一个人是否优秀来决定一个人的总价值的社会中，更为普遍。人们或多或少在假装自己某些地方的优秀，这种表面假装的优秀变成了他们去审视自身的最大敌人。在谈回想法，在《人性的弱点》的一书中，就教我们不要批判别人，不要反驳别人的观点去实施自己的观点，这种只会产生激烈的对抗，而是学会去诱导，所谓诱导是让我们一起去审视这些观点，抛开我们是这些想法的产生者，而是旁观者便能大程度的得到一个理性的结论</p><p>实践手册</p><ol><li>产生的想法时，先进行深呼吸几次，或是洗一下脸，让自己冷静一下</li><li>当冷静之后 ，把想法写在纸上，能用声音读出来就读出来，想着自己之前犯的错误<br>看产生想法时是否也犯了同样的错误，如果自己给自己定了一些准则，请把准则同样拿出来读几遍进行警醒</li><li>这时候其实你已经能发现自己想法是否有问题，如果没有的话，便就是找一个你的好朋友，谁的价值观念与你比较接近，询问他们你的想法的可行性与正确性，但记得决定权在你的手上，朋友的意见都只是参考，他们对想法产生的后果没有任何承担责任</li><li>做完这三步，你的想法的答案便已经进行充分思考了，同时如果想法产生的后果会具有冲突时，请在事情发生过后的两三天的时候再去进行讨论，便可以稍微消解其中的对抗性，因为过去的事少了时效性，便少了情绪的叠加</li></ol><hr><h3 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h3><p>从这篇开始，我将在每篇博客尾部推荐一首我喜欢的歌曲，可能就是今天偶尔听到的，觉得好听而已，个人主观性比较强，，本人也没什么多高的审美，更谈不到有很好的音乐素养，与普通人一样，只是听的比较多一点</p><p>《如果每天都可以happy，happy，谁想要sad》— 陈娴静</p><p>看了b站 HOPICO的第五届HMA的新人专辑和流行专辑的提名，发现这张专辑都有提名，我就听了整张专辑，这首是专辑的最后一首，表现出陈娴静独特的音乐风格，随性活泼，这张专辑表达主题之一是不要悲伤，要每天开心，但最后一首歌却写出人生中不是每天都可以开心的，在这荒谬中，在必定有的的悲伤中，我们要学会如何重新获得快乐</p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>什么是我</title>
      <link href="/2026/01/02/what-I-stand-for/"/>
      <url>/2026/01/02/what-I-stand-for/</url>
      
        <content type="html"><![CDATA[<h2 id="问题是什么"><a href="#问题是什么" class="headerlink" title="问题是什么"></a>问题是什么</h2><p>我到底在坚持什么，我到底想要什么，我到底如何能获得自在幸福</p><hr><p> 不知道要写啥，先留着坑，感觉自己有很多想法，但又有太多不切实际，当手放在键盘上的时候，也不知道到底想要表达什么，我好想表现出自己很忙的样子，可以不用想那些琐事，可以回到以前的生活轨迹，但我发现我像变了，以前那种天真烂满生活回不来了，不知道是受到的打击太大，还是生活环境的改变，我慢慢的跟我之前的身边的人走远，可以说是封闭自己，可以这样说，以前积极快乐的我，好像还是会继续笑着，但底色的忧伤感觉加重了，生活懒散，自暴自弃，反思内耗，逃避现实，我发现这些也开始变成常态，其实当初说出来我将重回深渊，我的内驱力就开始慢慢开始发力，原来以前的深渊并不是最低点，现在才是。</p><hr><p>但我需要向上爬，爬两步退一步也没关系，”能救自己的只有自己“，现在说出这句话，我只有感到可悲，之前的我一直渴望着别人的拯救，亦或者找一个同行者一起向上攀爬·，可是把希望寄托在别人身上，伤害的到来是必然的，而且没有任何的缓解借口，如同一把匕首刺入心窝，疼痛而长久，甚至还会有ptsd，可是总有一天心上的创口会愈合，外表还是会回到与从前无异样，但疤痕还在，虽不会疼痛，但也不再像完好心脏一样全力跳动了，但这也没关系，因为有千千万万的心脏与我一样，无需感到伤感，至少我的心脏跳动的频率不会改变，初心不变，终有一天会得圆满，在那之前，先tm给老子站起来，向前看，别总是放不过自己。</p><hr><p>前途迷离不定，但终点恒行则将至<br>情场坎坷曲折，但爱情永逐则将获</p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025年最后一次碎碎念</title>
      <link href="/2025/12/31/last-talk/"/>
      <url>/2025/12/31/last-talk/</url>
      
        <content type="html"><![CDATA[<h1 id="2025的我"><a href="#2025的我" class="headerlink" title="2025的我"></a>2025的我</h1><p>时间过的真快啊，2025年就这样过去，我在2024到2025年的跨年的时候，希望今年能够好过点，看了也是有点作用的，四分之三的时间是很一帆风顺的，其中有一个多月更是让我做了一个此生难以忘怀的梦。同时也度过了难以煎熬的三个月，其实并不是生活让我难以承受，更多的是自己不愿放过自己，自己与自己作对，越用思维对抗自己的思维，每个想法都是自我矛盾，而为居然在这种矛盾中，才能感受的平静与冷静。像个躲在自己房间角落的孩子，逃避着周围的一切，有种自暴自弃的感觉，但看我说的有多么严重，其实曾经也经常经历，或者我已经自认为这是常态。<br> 就这个自认为的想法，我也想了很多次</p><h1 id="反思忏悔"><a href="#反思忏悔" class="headerlink" title="反思忏悔"></a>反思忏悔</h1><p>我感觉我这个人可以什么都无所谓，又能什么都能敏感多想，对于在乎的人，总是说着我对你好是不求回报的，可事实呢，如果我在对方身上得不到同样的关心与照顾，妥协与改变，自己的心当然会伤心。同时每当冲突发生，又总以为改变，努力了便能解决问题，就想是从小教导，你要更加努力学习，才会有更好的成绩。从而导致我潜意识的认为，一件事情没有做的更好，或者有悲剧的发生，是因为我没有努力。但有些事情，不是考试，尤其是与人打交道，当一件事情中出现两个拥有主观能动性的人的时候，一个人在怎么努力也掌握不了这个关系的走向。</p><p>谈到人与人之间的关系，如何定义一段关系的亲密度是高是低亦或者关系的深浅标准，我在网上听到一种说法，就是一段关系之中的对抗性越少，关系更深更持久。想一想觉得也挺有道理的，对抗性是两个主体性不相融的表象，对立统一在关系也同样适用，但我也会有疑问，大家都在说保持主体性，又如何在关系减少对抗性，那按照我前面的想法，主体性不相融，我对此也没有印证过，有可能也有其他的原因，<br>大多时候的冲突其实就是双方价值观的冲突，人生观，世界观同样也会有冲突，但价值观是直接原因</p><hr><h1 id="音乐推荐"><a href="#音乐推荐" class="headerlink" title="音乐推荐"></a>音乐推荐</h1><p>最近爱听《相爱就是说了100次对不起》—— crispy脆乐团<br>那如果还有什么话没说清楚，那就是这些了<br>“对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起对不起”</p><hr>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Emby客户端播放器全端整理</title>
      <link href="/2025/12/28/Emby-players/"/>
      <url>/2025/12/28/Emby-players/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>市面上的Emby播放器客户端眼花撩乱，我想整理一份全端emby</p><p>android端</p><hr><p>yamby<br>hills</p><p>IOS端</p><hr><p>windows端</p><hr><p>Linux端</p><hr><p>MAC端</p><hr><p>android tv端</p><hr><p>Apple tv端</p>]]></content>
      
      
      <categories>
          
          <category> Emby </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Emby </tag>
            
            <tag> 播放器 </tag>
            
            <tag> 客户端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sdn实验</title>
      <link href="/2025/12/27/bezier/"/>
      <url>/2025/12/27/bezier/</url>
      
        <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 1. 导入相关的依赖</span></span><br><span class="line"><span class="keyword">from</span> mininet.net <span class="keyword">import</span> Mininet</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> Controller, RemoteController, OVSController</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> CPULimitedHost, Host, Node</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> OVSKernelSwitch, UserSwitch</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> IVSSwitch</span><br><span class="line"><span class="keyword">from</span> mininet.cli <span class="keyword">import</span> CLI</span><br><span class="line"><span class="keyword">from</span> mininet.log <span class="keyword">import</span> setLogLevel, info</span><br><span class="line"><span class="keyword">from</span> mininet.link <span class="keyword">import</span> TCLink, Intf</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> call</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myNetwork</span>():</span><br><span class="line">    <span class="comment"># 定义网络，在IP基地址为10.0.0.0/8上</span></span><br><span class="line">    net = Mininet(topo=<span class="literal">None</span>, build=<span class="literal">False</span>, ipBase=<span class="string">&#x27;10.0.0.0/8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加远程控制器\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 因为我们在本地运行ryu-manager充当控制器，故这里为远程控制器</span></span><br><span class="line">    <span class="comment"># RemoteController且IP地址为本地IP</span></span><br><span class="line">    c0 = net.addController(name=<span class="string">&#x27;c0&#x27;</span>,</span><br><span class="line">                           controller=RemoteController,</span><br><span class="line">                           ip=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                           protocol=<span class="string">&#x27;tcp&#x27;</span>,</span><br><span class="line">                           port=<span class="number">6633</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加交换机\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># dpid为16位编号</span></span><br><span class="line">    s1 = net.addSwitch(<span class="string">&#x27;s1&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000001&#x27;</span>)</span><br><span class="line">    s2 = net.addSwitch(<span class="string">&#x27;s2&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000002&#x27;</span>)</span><br><span class="line">    s3 = net.addSwitch(<span class="string">&#x27;s3&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000003&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加6台主机\n&#x27;</span>)</span><br><span class="line">    h1 = net.addHost(<span class="string">&#x27;h1&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.1&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h2 = net.addHost(<span class="string">&#x27;h2&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.2&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h3 = net.addHost(<span class="string">&#x27;h3&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.3&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h4 = net.addHost(<span class="string">&#x27;h4&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.4&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h5 = net.addHost(<span class="string">&#x27;h5&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.5&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h6 = net.addHost(<span class="string">&#x27;h6&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.6&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加链路\n&#x27;</span>)</span><br><span class="line">    net.addLink(s1, h1)</span><br><span class="line">    net.addLink(s1, h2)</span><br><span class="line">    net.addLink(s2, h3)</span><br><span class="line">    net.addLink(s2, h4)</span><br><span class="line">    net.addLink(s3, h5)</span><br><span class="line">    net.addLink(s3, h6)</span><br><span class="line">    <span class="comment"># 交换机级联</span></span><br><span class="line">    net.addLink(s3, s2)</span><br><span class="line">    net.addLink(s2, s1)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动网络\n&#x27;</span>)</span><br><span class="line">    net.build()</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动控制器\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> controller <span class="keyword">in</span> net.controllers:</span><br><span class="line">        controller.start()</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动交换机\n&#x27;</span>)</span><br><span class="line">    net.get(<span class="string">&#x27;s1&#x27;</span>).start([c0])</span><br><span class="line">    net.get(<span class="string">&#x27;s2&#x27;</span>).start([c0])</span><br><span class="line">    net.get(<span class="string">&#x27;s3&#x27;</span>).start([c0])</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 显示配置的交换机与主机信息\n&#x27;</span>)</span><br><span class="line">    CLI(net)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 停止运行</span></span><br><span class="line">    net.stop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    setLogLevel(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">    myNetwork()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习报告 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> study </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习日记</title>
      <link href="/2025/12/27/study-plan/"/>
      <url>/2025/12/27/study-plan/</url>
      
        <content type="html"><![CDATA[<hr><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>即将进入期末考试阶段，我以这篇博客，作为自己期末复习日记，督促自己完成的复习计划<br>本人是拖延症晚期患者，也想通过这样的方式改善自己的毛病，像更好的自己前进✍️</p><hr><h2 id="结业科目列表"><a href="#结业科目列表" class="headerlink" title="结业科目列表"></a>结业科目列表</h2><ul><li>计算机网络<ul><li>概念学习</li><li>代码学习</li><li>结业考试</li></ul></li><li>计算机操作系统<ul><li>实验概念学习</li><li>结业考试</li></ul></li><li>人工智能<ul><li>项目</li><li>结业考试</li></ul></li><li>计算机图形学<ul><li>项目答辩</li></ul></li><li>智能媒体技术<ul><li>自主学习</li><li>结业考试</li></ul></li></ul><hr><h2 id="日记"><a href="#日记" class="headerlink" title="日记"></a>日记</h2><h3 id="12月27-周六"><a href="#12月27-周六" class="headerlink" title="12月27 周六"></a>12月27 周六</h3><p>完成计算机图形学 贝塞尔曲线实验作业报告</p><h3 id="12月28-周日"><a href="#12月28-周日" class="headerlink" title="12月28 周日"></a>12月28 周日</h3><p>复习计算机操作系统进度5%<br>啥也没学，玩了一天（让我忏悔5分钟<br>但王麻子这集问鼎真不错，唢呐卡点好爽😄<br>推荐一下今日歌曲，《连名带姓》张惠妹唱的非常不错，周杰伦作曲</p><h2 id="1月7日-周三"><a href="#1月7日-周三" class="headerlink" title="1月7日 周三"></a>1月7日 周三</h2><p>操作系统复习20%<br>练习一会英语听力<br>《橙月》这张专辑真的太喜欢了，纯爱狂喜。有生之年等实体专辑不炒这么高了，一定要入一张，可惜相逢甚晚</p>]]></content>
      
      
      <categories>
          
          <category> 学习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> study </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Emby媒体服介绍及推荐</title>
      <link href="/2025/12/27/Emby/"/>
      <url>/2025/12/27/Emby/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>想让大家理解什么是Emby，什么是媒体服，如何使用Emby服</p><hr><h2 id="Emby是什么"><a href="#Emby是什么" class="headerlink" title="Emby是什么"></a>Emby是什么</h2><p>以下来自维基百科的介绍</p><blockquote><p><strong>Emby</strong>（原名Media Browser）是一个<a href="https://zh.wikipedia.org/wiki/%E4%B8%BB%E5%BE%9E%E5%BC%8F%E6%9E%B6%E6%A7%8B" title="主从式架构">主从式架构</a>的<a href="https://zh.wikipedia.org/wiki/%E5%AA%92%E4%BD%93%E6%9C%8D%E5%8A%A1%E5%99%A8" title="媒体服务器">媒体服务器</a>软件，可以用来整理服务器上的视频和音频，并将音频和视频<a href="https://zh.wikipedia.org/wiki/%E6%B5%81%E5%BC%8F%E5%A4%84%E7%90%86" title="流式处理">流式</a>传输到客户端设备。<br>Emby服务器端支持<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows" title="Microsoft Windows">Microsoft Windows</a>、<a href="https://zh.wikipedia.org/wiki/Linux" title="Linux">Linux</a>、<a href="https://zh.wikipedia.org/wiki/MacOS" title="MacOS">MacOS</a>、<a href="https://zh.wikipedia.org/wiki/FreeBSD" title="FreeBSD">FreeBSD</a>，客户端支持<a href="https://zh.wikipedia.org/wiki/HTML5" title="HTML5">HTML5</a>网页，<a href="https://zh.wikipedia.org/wiki/Android" title="Android">Android</a>和<a href="https://zh.wikipedia.org/wiki/IOS" title="IOS">IOS</a>等移动操作系统，<a href="https://zh.wikipedia.org/wiki/Roku" title="Roku">Roku</a>、<a href="https://zh.wikipedia.org/wiki/Amazon_Fire_TV" title="Amazon Fire TV">Amazon Fire TV</a>、<a href="https://zh.wikipedia.org/wiki/Chromecast" title="Chromecast">Chromecast</a>和<a href="https://zh.wikipedia.org/wiki/Apple_TV" title="Apple TV">Apple TV</a>等流媒体设备，LG智能电视和三星智能电视等智能电视，以及<a href="https://zh.wikipedia.org/wiki/PlayStation3" title="PlayStation3">PlayStation3</a>、<a href="https://zh.wikipedia.org/wiki/PlayStation_4" title="PlayStation 4">PlayStation4</a>、<a href="https://zh.wikipedia.org/wiki/Xbox_360" title="Xbox 360">Xbox 360</a>和<a href="https://zh.wikipedia.org/wiki/Xbox_One" title="Xbox One">Xbox One</a>等游戏机<br>Emby原本是大部分源代码是开源的，带有部分闭源工具，但是自从3.5.3版本开始变为闭源软件，<a href="https://zh.wikipedia.org/wiki/Jellyfin" title="Jellyfin">Jellyfin</a>为Emby开源分支基础上发展来的。</p></blockquote><p><strong>通俗来说：就是媒体（视频和音频）管理软件，并向外提供服务的软件，装的这个软件的机器就是服务器，你通过用户名，密码连接到服务器，浏览和播放所管理的媒体。日常我们使用的流媒体软件，爱优腾果b这类，也是服务器给你发送数据才能进行播放的</strong></p><hr><h2 id="如何使用Emby服务？"><a href="#如何使用Emby服务？" class="headerlink" title="如何使用Emby服务？"></a>如何使用Emby服务？</h2><p>Emby服务器提供网页服务，但是网页直接播放对服务器性能开销过大，而且使用硬件加速功能是要付费的。所以我们需要下载客户端，也就是需要下载软件，不同的平台有不同开发者开发的客户端，ui，播放逻辑，杜比映射等各有区别，选择适合自己的就行</p><p><strong>我将给这些播放器在另外一篇博客做整理</strong></p><p><strong>一般使用emby服务需要服务器线路，也就是网址，网址有时候还需要知道端口</strong></p><ol><li>emby搭建http默认端口是8096</li><li>如果是https的话端口一般是443</li><li>网址有时候是域名（像<a href="http://www.baidu.com).这种,有时候是ip(像192.168.5.1)这种,端口有时直接添加在ip/%E5%9F%9F%E5%90%8D%E5%90%8E%E9%9D%A2%EF%BC%8C">www.baidu.com)。这种，有时候是ip（像192.168.5.1）这种，端口有时直接添加在ip/域名后面，</a><br>（<a href="http://192.168.5.1:443/">http://192.168.5.1:443</a>) 就由三个部分组成，协议（http&#x2F;https），域名&#x2F;ip，还有端口</li></ol><p><strong>知道网址之后，服务器还需要验证你是否有账号，是否是合法账号，有账号才能使用服务，输入网址之后就会有要你输入用户名和密码来验证</strong></p><p>这一步简单不会有什么问题，只要注意密码复制粘贴的时候不要多复制了空格</p><p><strong>登录之后就可以尽情享受你的观影时光了</strong></p><p>以下我用ios端的客户端做一个添加服务器的示范（用的客户端是senplayer软件）</p><ol><li>首先你要做的是添加服务器，这里面有两个重点，一个是服务器，一个是添加，服务器你需要找到添加服务器的位置，而不是添加本地文件，添加什么iptv源这些，找到位置之后，添加的过程就是找到添加的字眼，或者有➕这样的按键，<br><img src="https://image.jellylove.cfd/PicGo/IMG_1536.PNG"></li><li>一般会软件会让你选择添加服务器的种类，意思你这个服务器是什么软件在运行，服务器上运行的是emby软件服务端，所以选择emby</li></ol><p><img src="https://image.jellylove.cfd/PicGo/IMG_1537.PNG"><br>3. 之后就会有让你添写路线，端口，用户名，密码的要求</p><p><img src="https://image.jellylove.cfd/PicGo/IMG_1538.PNG"></p>]]></content>
      
      
      <categories>
          
          <category> 概念介绍 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> Emby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的第一篇博客</title>
      <link href="/2025/12/26/first-blog/"/>
      <url>/2025/12/26/first-blog/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这是我的第一篇博客！<br>为什么想要写✍️博客呢？<br>我曾思考过如果世界是虚无的，无意义的，我做任何事情都没有意义，那活着是为了什么？也就是涉及到了哲学的问题“活着的意义是什么”，这个问题很大，我到现在也没想明白，但是我清楚认识到，这个问题的答案没有标准答案，你的回答有你自己的道理，是你自己的标准答案。经历过思考这件事，我认识到生活中遇到的问题也是如此，但大多时候都在被别人建议该怎么怎么做，亦或者学习那些相对来说成功的人的做法。而我觉得我们应该去思考自己的回答，并在有机会有能力的时候去实践。人生是自己的，”掌握自己的人生“不能因为它难以实现而认定其为不可能<br>写一个生活博客记录自己的错误 ，成长， 悔恨，幸福。等到博客的文章数越来越多，几年之后在看自己对那些问题的答案，可能是一次找回初心的时光锦囊 ，慢慢的，这些字里行间中已经表达了我自己对人生这张考卷的答案。<br>so I can say “I am alive！”</p>]]></content>
      
      
      <categories>
          
          <category> 日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
