<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>applemusic-dl | jelly's 小屋</title><meta name="author" content="jelly"><meta name="copyright" content="jelly"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="使用的是开源项目 https:&#x2F;&#x2F;github.com&#x2F;hatimalu&#x2F;AppleMusic_downloader?tab&#x3D;readme-ov-file 我现在使用的系统是macos sequoia15.7主要看的是这篇教程 https:&#x2F;&#x2F;applemusic.mintlify.app&#x2F;amdl&#x2F;quickstart&#x2F;macos 但其中的第一步的操作改成如下操作  #开发工具及图形化 Dock">
<meta property="og:type" content="article">
<meta property="og:title" content="applemusic-dl">
<meta property="og:url" content="http://world.jellylove.cfd/2026/01/12/2026-1-12/index.html">
<meta property="og:site_name" content="jelly&#39;s 小屋">
<meta property="og:description" content="使用的是开源项目 https:&#x2F;&#x2F;github.com&#x2F;hatimalu&#x2F;AppleMusic_downloader?tab&#x3D;readme-ov-file 我现在使用的系统是macos sequoia15.7主要看的是这篇教程 https:&#x2F;&#x2F;applemusic.mintlify.app&#x2F;amdl&#x2F;quickstart&#x2F;macos 但其中的第一步的操作改成如下操作  #开发工具及图形化 Dock">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png">
<meta property="article:published_time" content="2026-01-12T01:41:22.000Z">
<meta property="article:modified_time" content="2026-01-12T02:54:19.272Z">
<meta property="article:author" content="jelly">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "applemusic-dl",
  "url": "http://world.jellylove.cfd/2026/01/12/2026-1-12/",
  "image": "https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png",
  "datePublished": "2026-01-12T01:41:22.000Z",
  "dateModified": "2026-01-12T02:54:19.272Z",
  "author": [
    {
      "@type": "Person",
      "name": "jelly",
      "url": "http://world.jellylove.cfd"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://world.jellylove.cfd/2026/01/12/2026-1-12/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'applemusic-dl',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style> body { cursor: url('https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/img/default.cur'), auto; } a:hover { cursor: url('https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/img/pointer.cur'), auto; } </style><meta name="generator" content="Hexo 8.1.1"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div class="bg-animation" id="web_bg" style="background-image: url(/img/%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">jelly's 小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">applemusic-dl</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">applemusic-dl</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-12T01:41:22.000Z" title="发表于 2026-01-12 09:41:22">2026-01-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-12T02:54:19.272Z" title="更新于 2026-01-12 10:54:19">2026-01-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>使用的是开源项目 <a target="_blank" rel="noopener" href="https://github.com/hatimalu/AppleMusic_downloader?tab=readme-ov-file">https://github.com/hatimalu/AppleMusic_downloader?tab=readme-ov-file</a></p>
<p>我现在使用的系统是macos sequoia15.7<br>主要看的是这篇教程 <a target="_blank" rel="noopener" href="https://applemusic.mintlify.app/amdl/quickstart/macos">https://applemusic.mintlify.app/amdl/quickstart/macos</a></p>
<p>但其中的第一步的操作改成如下操作</p>
<blockquote>
<p>#开发工具及图形化 Docker<br><code>brew install go gpac git &amp;&amp; brew install --cask docker &amp;&amp; git clone https://github.com/zhaarey/apple-music-downloader.git</code></p>
</blockquote>
<p>然后就安装引用教程操作即可</p>
<hr>
<p>win端推荐一个本地音乐播放器 建议购买steam版本（以后使用创意工坊更简单）<br><a target="_blank" rel="noopener" href="https://moriafly.com/program/spw.html">https://moriafly.com/program/spw.html</a></p>
<hr>
<p>本项目 歌词下载有bug，已用ai修复</p>
<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>在处理 TTML 格式的歌词时，代码假设某些 XML 元素一定存在，但实际上：</p>
<ul>
<li><p>第 343 行：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.ChildElements()</span><br></pre></td></tr></table></figure>
<p>   - </p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans</span><br></pre></td></tr></table></figure>
<p>   可能为 </p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure>
<p>  （音译元素不存在时）</p>
</li>
<li><p>第 371 行：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.SelectAttr(&quot;text&quot;)</span><br></pre></td></tr></table></figure>
<p>   - </p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans</span><br></pre></td></tr></table></figure>
<p>   可能为 </p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure>
<p>  （翻译元素不存在时）</p>
</li>
</ul>
<p>当 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FindElement()</span><br></pre></td></tr></table></figure>

<p> 找不到相应的 XML 元素时，它会返回 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure>

<p>，而代码直接使用了这些 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nil</span><br></pre></td></tr></table></figure>

<p> 值，导致程序崩溃。</p>
<h3 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h3><p>我已经在两处添加了 <strong>空值检查（nil check）</strong>：</p>
<ol>
<li><p><strong>第 343 行附近</strong>（音译处理）：在访问 </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.ChildElements()</span><br></pre></td></tr></table></figure>
<p>  之前检查 </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans != nil</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>第 371 行附近</strong>（翻译处理）：在访问 </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans.SelectAttr()</span><br></pre></td></tr></table></figure>
<p>  之前检查 </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trans != nil</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="修改-lyrics-go-文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）"><a href="#修改-lyrics-go-文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）" class="headerlink" title="修改 lyrics.go 文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）"></a>修改 lyrics.go 文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> lyrics</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/beevik/etree&quot;</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SongLyrics <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Data []<span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Id <span class="type">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line"></span><br><span class="line">Type <span class="type">string</span> <span class="string">`json:&quot;type&quot;`</span></span><br><span class="line"></span><br><span class="line">Attributes <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Ttml <span class="type">string</span> <span class="string">`json:&quot;ttml&quot;`</span></span><br><span class="line"></span><br><span class="line">TtmlLocalizations <span class="type">string</span> <span class="string">`json:&quot;ttmlLocalizations&quot;`</span></span><br><span class="line"></span><br><span class="line">PlayParams <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">Id <span class="type">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line"></span><br><span class="line">Kind <span class="type">string</span> <span class="string">`json:&quot;kind&quot;`</span></span><br><span class="line"></span><br><span class="line">CatalogId <span class="type">string</span> <span class="string">`json:&quot;catalogId&quot;`</span></span><br><span class="line"></span><br><span class="line">DisplayType <span class="type">int</span> <span class="string">`json:&quot;displayType&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="string">`json:&quot;playParams&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="string">`json:&quot;attributes&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Get</span><span class="params">(storefront, songId, lrcType, language, lrcFormat, token, mediaUserToken <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(mediaUserToken) &lt; <span class="number">50</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;MediaUserToken not set&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">ttml, err := getSongLyrics(songId, storefront, token, mediaUserToken, lrcType, language)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lrcFormat == <span class="string">&quot;ttml&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ttml, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">lrc, err := TtmlToLrc(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> lrc, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSongLyrics</span><span class="params">(songId <span class="type">string</span>, storefront <span class="type">string</span>, token <span class="type">string</span>, userToken <span class="type">string</span>, lrcType <span class="type">string</span>, language <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">req, err := http.NewRequest(<span class="string">&quot;GET&quot;</span>,</span><br><span class="line"></span><br><span class="line">fmt.Sprintf(<span class="string">&quot;https://amp-api.music.apple.com/v1/catalog/%s/songs/%s/%s?l=%s&amp;extend=ttmlLocalizations&quot;</span>, storefront, songId, lrcType, language), <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req.Header.Set(<span class="string">&quot;Origin&quot;</span>, <span class="string">&quot;https://music.apple.com&quot;</span>)</span><br><span class="line"></span><br><span class="line">req.Header.Set(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;https://music.apple.com/&quot;</span>)</span><br><span class="line"></span><br><span class="line">req.Header.Set(<span class="string">&quot;Authorization&quot;</span>, fmt.Sprintf(<span class="string">&quot;Bearer %s&quot;</span>, token))</span><br><span class="line"></span><br><span class="line">cookie := http.Cookie&#123;Name: <span class="string">&quot;media-user-token&quot;</span>, Value: userToken&#125;</span><br><span class="line"></span><br><span class="line">req.AddCookie(&amp;cookie)</span><br><span class="line"></span><br><span class="line">do, err := http.DefaultClient.Do(req)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">defer</span> do.Body.Close()</span><br><span class="line"></span><br><span class="line">obj := <span class="built_in">new</span>(SongLyrics)</span><br><span class="line"></span><br><span class="line">_ = json.NewDecoder(do.Body).Decode(&amp;obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> obj.Data != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(obj.Data[<span class="number">0</span>].Attributes.Ttml) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> obj.Data[<span class="number">0</span>].Attributes.Ttml, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> obj.Data[<span class="number">0</span>].Attributes.TtmlLocalizations, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;failed to get lyrics&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">// Use for detect if lyrics have CJK, will be replaced by transliteration if exist.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">containsCJK</span><span class="params">(s <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, r := <span class="keyword">range</span> s &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (r &gt;= <span class="number">0x1100</span> &amp;&amp; r &lt;= <span class="number">0x11FF</span>) || <span class="comment">// Hangul Jamo</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2E80</span> &amp;&amp; r &lt;= <span class="number">0x2EFF</span>) || <span class="comment">// CJK Radicals Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2F00</span> &amp;&amp; r &lt;= <span class="number">0x2FDF</span>) || <span class="comment">// Kangxi Radicals</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2FF0</span> &amp;&amp; r &lt;= <span class="number">0x2FFF</span>) || <span class="comment">// Ideographic Description Characters</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3000</span> &amp;&amp; r &lt;= <span class="number">0x303F</span>) || <span class="comment">// CJK Symbols and Punctuation</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3040</span> &amp;&amp; r &lt;= <span class="number">0x309F</span>) || <span class="comment">// Hiragana</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x30A0</span> &amp;&amp; r &lt;= <span class="number">0x30FF</span>) || <span class="comment">// Katakana</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3130</span> &amp;&amp; r &lt;= <span class="number">0x318F</span>) || <span class="comment">// Hangul Compatibility Jamo</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x31C0</span> &amp;&amp; r &lt;= <span class="number">0x31EF</span>) || <span class="comment">// CJK Strokes</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x31F0</span> &amp;&amp; r &lt;= <span class="number">0x31FF</span>) || <span class="comment">// Katakana Phonetic Extensions</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3200</span> &amp;&amp; r &lt;= <span class="number">0x32FF</span>) || <span class="comment">// Enclosed CJK Letters and Months</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3300</span> &amp;&amp; r &lt;= <span class="number">0x33FF</span>) || <span class="comment">// CJK Compatibility</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x3400</span> &amp;&amp; r &lt;= <span class="number">0x4DBF</span>) || <span class="comment">// CJK Unified Ideographs Extension A</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x4E00</span> &amp;&amp; r &lt;= <span class="number">0x9FFF</span>) || <span class="comment">// CJK Unified Ideographs</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xA960</span> &amp;&amp; r &lt;= <span class="number">0xA97F</span>) || <span class="comment">// Hangul Jamo Extended-A</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xAC00</span> &amp;&amp; r &lt;= <span class="number">0xD7AF</span>) || <span class="comment">// Hangul Syllables</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xD7B0</span> &amp;&amp; r &lt;= <span class="number">0xD7FF</span>) || <span class="comment">// Hangul Jamo Extended-B</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xF900</span> &amp;&amp; r &lt;= <span class="number">0xFAFF</span>) || <span class="comment">// CJK Compatibility Ideographs</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xFE30</span> &amp;&amp; r &lt;= <span class="number">0xFE4F</span>) || <span class="comment">// CJK Compatibility Forms</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xFF65</span> &amp;&amp; r &lt;= <span class="number">0xFF9F</span>) || <span class="comment">// Halfwidth Katakana</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0xFFA0</span> &amp;&amp; r &lt;= <span class="number">0xFFDC</span>) || <span class="comment">// Halfwidth Jamo</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1AFF0</span> &amp;&amp; r &lt;= <span class="number">0x1AFFF</span>) || <span class="comment">// Kana Extended-B</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1B000</span> &amp;&amp; r &lt;= <span class="number">0x1B0FF</span>) || <span class="comment">// Kana Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1B100</span> &amp;&amp; r &lt;= <span class="number">0x1B12F</span>) || <span class="comment">// Kana Extended-A</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1B130</span> &amp;&amp; r &lt;= <span class="number">0x1B16F</span>) || <span class="comment">// Small Kana Extension</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x1F200</span> &amp;&amp; r &lt;= <span class="number">0x1F2FF</span>) || <span class="comment">// Enclosed Ideographic Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x20000</span> &amp;&amp; r &lt;= <span class="number">0x2A6DF</span>) || <span class="comment">// CJK Unified Ideographs Extension B</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2A700</span> &amp;&amp; r &lt;= <span class="number">0x2B73F</span>) || <span class="comment">// CJK Unified Ideographs Extension C</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2B740</span> &amp;&amp; r &lt;= <span class="number">0x2B81F</span>) || <span class="comment">// CJK Unified Ideographs Extension D</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2B820</span> &amp;&amp; r &lt;= <span class="number">0x2CEAF</span>) || <span class="comment">// CJK Unified Ideographs Extension E</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2CEB0</span> &amp;&amp; r &lt;= <span class="number">0x2EBEF</span>) || <span class="comment">// CJK Unified Ideographs Extension F</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2EBF0</span> &amp;&amp; r &lt;= <span class="number">0x2EE5F</span>) || <span class="comment">// CJK Unified Ideographs Extension I</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x2F800</span> &amp;&amp; r &lt;= <span class="number">0x2FA1F</span>) || <span class="comment">// CJK Compatibility Ideographs Supplement</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x30000</span> &amp;&amp; r &lt;= <span class="number">0x3134F</span>) || <span class="comment">// CJK Unified Ideographs Extension G</span></span><br><span class="line"></span><br><span class="line">(r &gt;= <span class="number">0x31350</span> &amp;&amp; r &lt;= <span class="number">0x323AF</span>) &#123; <span class="comment">// CJK Unified Ideographs Extension H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TtmlToLrc</span><span class="params">(ttml <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">parsedTTML := etree.NewDocument()</span><br><span class="line"></span><br><span class="line">err := parsedTTML.ReadFromString(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lrcLines []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">timingAttr := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).SelectAttr(<span class="string">&quot;itunes:timing&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> timingAttr != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> timingAttr.Value == <span class="string">&quot;Word&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">lrc, err := conventSyllableTTMLToLRC(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> lrc, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> timingAttr.Value == <span class="string">&quot;None&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, p := <span class="keyword">range</span> parsedTTML.FindElements(<span class="string">&quot;//p&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">line := p.Text()</span><br><span class="line"></span><br><span class="line">line = strings.TrimSpace(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> line != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, line)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strings.Join(lrcLines, <span class="string">&quot;\n&quot;</span>), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;body&quot;</span>).ChildElements() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, lyric := <span class="keyword">range</span> item.ChildElements() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h, m, s, ms <span class="type">int</span></span><br><span class="line"></span><br><span class="line">beginAttr := lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> beginAttr == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;no synchronised lyrics&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beginValue := beginAttr.Value</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strings.Contains(beginValue, <span class="string">&quot;:&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d:%d:%d.%d&quot;</span>, &amp;h, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d:%d.%d&quot;</span>, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d:%d&quot;</span>, &amp;m, &amp;s)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(beginValue, <span class="string">&quot;%d.%d&quot;</span>, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line">h, m = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m += h * <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ms = ms / <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text, transText, translitText <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//GET trans and translit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElements(<span class="string">&quot;head&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElements(<span class="string">&quot;metadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">Metadata := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElement(<span class="string">&quot;metadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(Metadata.FindElements(<span class="string">&quot;iTunesMetadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">iTunesMetadata := Metadata.FindElement(<span class="string">&quot;iTunesMetadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;transliterations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElements(<span class="string">&quot;transliteration&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;text[@for=&#x27;%s&#x27;]&quot;</span>, lyric.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">translit := iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElement(<span class="string">&quot;transliteration&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> translit != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> translit.SelectAttr(<span class="string">&quot;text&quot;</span>) != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">translitText = translit.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> translitTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> translit.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">translitTmp = <span class="built_in">append</span>(translitTmp, c.Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> e, ok := span.(*etree.Element); ok &#123;</span><br><span class="line"></span><br><span class="line">translitTmp = <span class="built_in">append</span>(translitTmp, e.Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">translitText = strings.Join(translitTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;translations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElements(<span class="string">&quot;translation&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;//text[@for=&#x27;%s&#x27;]&quot;</span>, lyric.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">trans := iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElement(<span class="string">&quot;translation&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans.SelectAttr(<span class="string">&quot;text&quot;</span>) != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">transText = trans.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> trans.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">transTmp = <span class="built_in">append</span>(transTmp, c.Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> e, ok := span.(*etree.Element); ok &#123;</span><br><span class="line"></span><br><span class="line">transTmp = <span class="built_in">append</span>(transTmp, e.Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transText = strings.Join(transTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lyric.SelectAttr(<span class="string">&quot;text&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> lyric.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.CharData).Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.Element).Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text = strings.Join(textTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">text = lyric.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(translitText) &gt; <span class="number">0</span> &amp;&amp; containsCJK(text) &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]%s&quot;</span>, m, s, ms, translitText))</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]%s&quot;</span>, m, s, ms, text))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(transText) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]%s&quot;</span>, m, s, ms, transText))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strings.Join(lrcLines, <span class="string">&quot;\n&quot;</span>), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">conventSyllableTTMLToLRC</span><span class="params">(ttml <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line">parsedTTML := etree.NewDocument()</span><br><span class="line"></span><br><span class="line">err := parsedTTML.ReadFromString(ttml)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lrcLines []<span class="type">string</span></span><br><span class="line"></span><br><span class="line">parseTime := <span class="function"><span class="keyword">func</span><span class="params">(timeValue <span class="type">string</span>, newLine <span class="type">int</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h, m, s, ms <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strings.Contains(timeValue, <span class="string">&quot;:&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(timeValue, <span class="string">&quot;%d:%d:%d.%d&quot;</span>, &amp;h, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(timeValue, <span class="string">&quot;%d:%d.%d&quot;</span>, &amp;m, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line">h = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">_, err = fmt.Sscanf(timeValue, <span class="string">&quot;%d.%d&quot;</span>, &amp;s, &amp;ms)</span><br><span class="line"></span><br><span class="line">h, m = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m += h * <span class="number">60</span></span><br><span class="line"></span><br><span class="line">ms = ms / <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> newLine == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]&lt;%02d:%02d.%02d&gt;&quot;</span>, m, s, ms, m, s, ms), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> newLine == <span class="number">-1</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;[%02d:%02d.%02d]&quot;</span>, m, s, ms), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;&lt;%02d:%02d.%02d&gt;&quot;</span>, m, s, ms), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">divs := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;body&quot;</span>).FindElements(<span class="string">&quot;div&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, div := <span class="keyword">range</span> divs &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> div.ChildElements() &#123; <span class="comment">//LINES</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lrcSyllables []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> endTime, translitLine, transLine <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, lyrics := <span class="keyword">range</span> item.Child &#123; <span class="comment">//WORDS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := lyrics.(*etree.CharData); ok &#123; <span class="comment">//是否为span之间的空格</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcSyllables = <span class="built_in">append</span>(lrcSyllables, <span class="string">&quot; &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lyric := lyrics.(*etree.Element)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">beginTime, err := parseTime(lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>).Value, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">endTime, err = parseTime(lyric.SelectAttr(<span class="string">&quot;end&quot;</span>).Value, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> lyric.SelectAttr(<span class="string">&quot;text&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> lyric.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.CharData).Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.Element).Text())</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">text = strings.Join(textTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">text = lyric.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lrcSyllables = <span class="built_in">append</span>(lrcSyllables, fmt.Sprintf(<span class="string">&quot;%s%s&quot;</span>, beginTime, text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">transBeginTime, _ := parseTime(lyric.SelectAttr(<span class="string">&quot;begin&quot;</span>).Value, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">sharedTimestamp := <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElements(<span class="string">&quot;head&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElements(<span class="string">&quot;metadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">Metadata := parsedTTML.FindElement(<span class="string">&quot;tt&quot;</span>).FindElement(<span class="string">&quot;head&quot;</span>).FindElement(<span class="string">&quot;metadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(Metadata.FindElements(<span class="string">&quot;iTunesMetadata&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">iTunesMetadata := Metadata.FindElement(<span class="string">&quot;iTunesMetadata&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;transliterations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElements(<span class="string">&quot;transliteration&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;text[@for=&#x27;%s&#x27;]&quot;</span>, item.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">trans := iTunesMetadata.FindElement(<span class="string">&quot;transliterations&quot;</span>).FindElement(<span class="string">&quot;transliteration&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get text content</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transTxtParts []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transStartTime <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, span := <span class="keyword">range</span> trans.ChildElements() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> span.Tag == <span class="string">&quot;span&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">spanBegin := span.SelectAttrValue(<span class="string">&quot;begin&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">spanText := span.Text()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> spanBegin == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get timestamp</span></span><br><span class="line"></span><br><span class="line">timestamp, err := parseTime(spanBegin, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// For [mm:ss.xx] prefix</span></span><br><span class="line"></span><br><span class="line">transStartTime, _ = parseTime(spanBegin, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">sharedTimestamp = transStartTime</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transTxtParts = <span class="built_in">append</span>(transTxtParts, fmt.Sprintf(<span class="string">&quot;%s%s&quot;</span>, timestamp, spanText))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">translitLine = fmt.Sprintf(<span class="string">&quot;%s%s&quot;</span>, transStartTime, strings.Join(transTxtParts, <span class="string">&quot; &quot;</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElements(<span class="string">&quot;translations&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElements(<span class="string">&quot;translation&quot;</span>)) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">xpath := fmt.Sprintf(<span class="string">&quot;//text[@for=&#x27;%s&#x27;]&quot;</span>, item.SelectAttr(<span class="string">&quot;itunes:key&quot;</span>).Value)</span><br><span class="line"></span><br><span class="line">trans := iTunesMetadata.FindElement(<span class="string">&quot;translations&quot;</span>).FindElement(<span class="string">&quot;translation&quot;</span>).FindElement(xpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transTxt <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans != <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> trans.SelectAttr(<span class="string">&quot;text&quot;</span>) == <span class="literal">nil</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTmp []<span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, span := <span class="keyword">range</span> trans.Child &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := span.(*etree.CharData); ok &#123;</span><br><span class="line"></span><br><span class="line">textTmp = <span class="built_in">append</span>(textTmp, span.(*etree.CharData).Data)</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">/*else &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">textTmp = append(textTmp, span.(*etree.Element).Text())</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transTxt = strings.Join(textTmp, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">transTxt = trans.SelectAttr(<span class="string">&quot;text&quot;</span>).Value</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fmt.Println(transTxt)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sharedTimestamp != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"></span><br><span class="line">transLine = sharedTimestamp + transTxt</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">transLine = transBeginTime + transTxt</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//endTime, err := parseTime(item.SelectAttr(&quot;end&quot;).Value)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//if err != nil &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// return &quot;&quot;, err</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(translitLine) &gt; <span class="number">0</span> &amp;&amp; containsCJK(strings.Join(lrcSyllables, <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, translitLine)</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, strings.Join(lrcSyllables, <span class="string">&quot;&quot;</span>)+endTime)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(transLine) &gt; <span class="number">0</span> &#123;</span><br><span class="line"></span><br><span class="line">lrcLines = <span class="built_in">append</span>(lrcLines, transLine)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> strings.Join(lrcLines, <span class="string">&quot;\n&quot;</span>), <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样下歌词就不会崩溃了</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://world.jellylove.cfd">jelly</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://world.jellylove.cfd/2026/01/12/2026-1-12/">http://world.jellylove.cfd/2026/01/12/2026-1-12/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://world.jellylove.cfd" target="_blank">jelly's 小屋</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/12/sdn/" title="sdn"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">sdn</div></div><div class="info-2"><div class="info-item-1"> 网络拓扑生成python文件 demo.py  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768# 1. 导入相关的依赖from mininet.net import Mininetfrom mininet.node import Controller, RemoteController, OVSControllerfrom mininet.node import CPULimitedHost, Host, Nodefrom mininet.node import OVSKernelSwitch, UserSwitchfrom mininet.node import IVSSwitchfrom mininet.cli import CLIfrom mininet.log import setLogLevel, infofrom mininet.link import TCLi...</div></div></div></a><a class="pagination-related" href="/2026/01/11/2026-1-11-2/" title="我的情绪不是我"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">我的情绪不是我</div></div><div class="info-2"><div class="info-item-1">如果一直活在自己的情绪里，我感觉我迟早有一天会承受不住的，不知道是怎么了，以前让我感到快乐的东西，以前我能保持专注力做的事情现在已经难以保持较长时间，是发现有些事情，就算是你努力也是没有好结果的吗，拜托，我人生中没有几件认真去做的事，唯一一两件我觉得非常重要的事情，却落得现在这样的下场。世界法则，社会规则，人际关系我真的在学了，但是我真的难以融进去这一切的原因正的是因为我的价值支点太少了吗，想想也是，人应该是疯狂爱上什么才能活下去，到底什么是我爱上的东西，我到底适合什么，我为什么这么贬低自己，不断反思自己，难道是因为我觉得一件事情没做好一定是自己的原因吗，为什么有些毫不在意，有些久久环绕，真的是矛盾，我真的能接受自己吗，我感觉要被自己的想法内耗死了，自认为的道德也在压着我，我真的想变得很烂，可是真做成那样就不是我了。算了，累了，每天打打字，在个人世界发点牢骚希望能有点缓解，不是我封闭自己，是我的想法已经没有社交欲望了，但我只能记住，我的想法不是我，不被想法真的内耗致死罢了  我的想法不是我我的想法不是我我的想法不是我  还有一些不变的东西陪着我，或许音乐是我一辈子不会舍去的东西，...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">jelly</div><div class="author-info-description">记录生活点滴，分享技术知识，记录成长轨迹</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.</span> <span class="toc-text">问题原因</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.</span> <span class="toc-text">修复方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-lyrics-go-%E6%96%87%E4%BB%B6%E5%8D%B3%E5%8F%AF%EF%BC%88%E9%A1%BA%E4%BE%BF%E6%94%B9%E4%BA%86%E7%BF%BB%E8%AF%91%E5%92%8C%E5%8E%9F%E6%96%87%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%88%E8%8B%B1%E6%96%87%E5%9C%A8%E4%B8%8A%EF%BC%8C%E7%BF%BB%E8%AF%91%E5%9C%A8%E4%B8%8B%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">修改 lyrics.go 文件即可（顺便改了翻译和原文的顺序（英文在上，翻译在下）</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/18/2026-1-17/" title="Sorry and Goodbye"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sorry and Goodbye"/></a><div class="content"><a class="title" href="/2026/01/18/2026-1-17/" title="Sorry and Goodbye">Sorry and Goodbye</a><time datetime="2026-01-17T16:42:56.000Z" title="发表于 2026-01-18 00:42:56">2026-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/16/2026-1-16/" title="悲伤上瘾"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="悲伤上瘾"/></a><div class="content"><a class="title" href="/2026/01/16/2026-1-16/" title="悲伤上瘾">悲伤上瘾</a><time datetime="2026-01-16T12:18:23.000Z" title="发表于 2026-01-16 20:18:23">2026-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/16/%E6%9C%AA%E5%91%BD%E5%90%8D%201/" title="无标题">无标题</a><time datetime="2026-01-16T01:40:51.891Z" title="发表于 2026-01-16 09:40:51">2026-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/15/Excalidraw/Drawing%202026-01-15%2015.28.37.excalidraw/" title="无标题">无标题</a><time datetime="2026-01-15T07:28:37.095Z" title="发表于 2026-01-15 15:28:37">2026-01-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/15/2026-01-15/" title="无标题">无标题</a><time datetime="2026-01-15T07:28:01.652Z" title="发表于 2026-01-15 15:28:01">2026-01-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By jelly</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/mouse_snow.min.js"></script><div class="aplayer no-destroy" data-id="17633723458" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>