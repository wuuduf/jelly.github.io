<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>sdn | jelly's 小屋</title><meta name="author" content="jelly"><meta name="copyright" content="jelly"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="网络拓扑生成python文件 demo.py  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768# 1. 导入相关的依赖from mininet.net import Mininetfrom">
<meta property="og:type" content="article">
<meta property="og:title" content="sdn">
<meta property="og:url" content="http://world.jellylove.cfd/2026/01/12/sdn/index.html">
<meta property="og:site_name" content="jelly&#39;s 小屋">
<meta property="og:description" content="网络拓扑生成python文件 demo.py  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768# 1. 导入相关的依赖from mininet.net import Mininetfrom">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png">
<meta property="article:published_time" content="2026-01-12T08:44:55.000Z">
<meta property="article:modified_time" content="2026-01-12T08:57:51.223Z">
<meta property="article:author" content="jelly">
<meta property="article:tag" content="study">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "sdn",
  "url": "http://world.jellylove.cfd/2026/01/12/sdn/",
  "image": "https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png",
  "datePublished": "2026-01-12T08:44:55.000Z",
  "dateModified": "2026-01-12T08:57:51.223Z",
  "author": [
    {
      "@type": "Person",
      "name": "jelly",
      "url": "http://world.jellylove.cfd"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://world.jellylove.cfd/2026/01/12/sdn/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'sdn',
  isHighlightShrink: false,
  isToc: false,
  pageType: 'post'
}</script><style> body { cursor: url('https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/img/default.cur'), auto; } a:hover { cursor: url('https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/img/pointer.cur'), auto; } </style><meta name="generator" content="Hexo 8.1.1"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div class="bg-animation" id="web_bg" style="background-image: url(/img/%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">jelly's 小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">sdn</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">sdn</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-12T08:44:55.000Z" title="发表于 2026-01-12 16:44:55">2026-01-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-12T08:57:51.223Z" title="更新于 2026-01-12 16:57:51">2026-01-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E6%8A%A5%E5%91%8A/">学习报告</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><ol>
<li>网络拓扑生成python文件 demo.py</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 导入相关的依赖</span></span><br><span class="line"><span class="keyword">from</span> mininet.net <span class="keyword">import</span> Mininet</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> Controller, RemoteController, OVSController</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> CPULimitedHost, Host, Node</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> OVSKernelSwitch, UserSwitch</span><br><span class="line"><span class="keyword">from</span> mininet.node <span class="keyword">import</span> IVSSwitch</span><br><span class="line"><span class="keyword">from</span> mininet.cli <span class="keyword">import</span> CLI</span><br><span class="line"><span class="keyword">from</span> mininet.log <span class="keyword">import</span> setLogLevel, info</span><br><span class="line"><span class="keyword">from</span> mininet.link <span class="keyword">import</span> TCLink, Intf</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> call</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myNetwork</span>():</span><br><span class="line">    <span class="comment"># 定义网络，在IP基地址为10.0.0.0/8上</span></span><br><span class="line">    net = Mininet(topo=<span class="literal">None</span>, build=<span class="literal">False</span>, ipBase=<span class="string">&#x27;10.0.0.0/8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加远程控制器\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 因为我们在本地运行ryu-manager充当控制器，故这里为远程控制器</span></span><br><span class="line">    <span class="comment"># RemoteController且IP地址为本地IP</span></span><br><span class="line">    c0 = net.addController(name=<span class="string">&#x27;c0&#x27;</span>,</span><br><span class="line">                           controller=RemoteController,</span><br><span class="line">                           ip=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">                           protocol=<span class="string">&#x27;tcp&#x27;</span>,</span><br><span class="line">                           port=<span class="number">6633</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加交换机\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># dpid为16位编号</span></span><br><span class="line">    s1 = net.addSwitch(<span class="string">&#x27;s1&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000001&#x27;</span>)</span><br><span class="line">    s2 = net.addSwitch(<span class="string">&#x27;s2&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000002&#x27;</span>)</span><br><span class="line">    s3 = net.addSwitch(<span class="string">&#x27;s3&#x27;</span>, cls=OVSKernelSwitch, dpid=<span class="string">&#x27;0000000000000003&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加3台主机\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 根据图片，只有 h1, h2, h3</span></span><br><span class="line">    h1 = net.addHost(<span class="string">&#x27;h1&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.1&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h2 = net.addHost(<span class="string">&#x27;h2&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.2&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line">    h3 = net.addHost(<span class="string">&#x27;h3&#x27;</span>, cls=Host, ip=<span class="string">&#x27;10.0.0.3&#x27;</span>, defaultRoute=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 添加链路\n&#x27;</span>)</span><br><span class="line">    <span class="comment"># 主机与交换机的连接</span></span><br><span class="line">    net.addLink(s1, h1)</span><br><span class="line">    net.addLink(s2, h2)</span><br><span class="line">    net.addLink(s3, h3)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 交换机级联（形成图片中的三角形环路）</span></span><br><span class="line">    net.addLink(s1, s2)</span><br><span class="line">    net.addLink(s2, s3)</span><br><span class="line">    net.addLink(s3, s1)</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动网络\n&#x27;</span>)</span><br><span class="line">    net.build()</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动控制器\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> controller <span class="keyword">in</span> net.controllers:</span><br><span class="line">        controller.start()</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 启动交换机\n&#x27;</span>)</span><br><span class="line">    net.get(<span class="string">&#x27;s1&#x27;</span>).start([c0])</span><br><span class="line">    net.get(<span class="string">&#x27;s2&#x27;</span>).start([c0])</span><br><span class="line">    net.get(<span class="string">&#x27;s3&#x27;</span>).start([c0])</span><br><span class="line"></span><br><span class="line">    info(<span class="string">&#x27;*** 显示配置的交换机与主机信息\n&#x27;</span>)</span><br><span class="line">    CLI(net)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 停止运行</span></span><br><span class="line">    net.stop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    setLogLevel(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">    myNetwork()</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>最短路径转发 shortest_ forwarding.py</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shortest_forwarding.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> CONFIG_DISPATCHER, MAIN_DISPATCHER, DEAD_DISPATCHER</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> ethernet, arp, ether_types</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event, switches</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShortestPathForwarding</span>(app_manager.RyuApp):</span><br><span class="line"></span><br><span class="line">OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line"><span class="built_in">super</span>(ShortestPathForwarding, <span class="variable language_">self</span>).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化有向图</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net = nx.DiGraph()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录主机位置: mac -&gt; (dpid, port)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录 IP -&gt; MAC 映射 (用于 ARP 代理)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;下发缺省流表，将无法匹配的包上报给控制器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">datapath = ev.msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;下发流表项&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line"></span><br><span class="line">actions)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> buffer_id:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line"></span><br><span class="line">priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line"></span><br><span class="line">instructions=inst)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 拓扑发现部分 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventSwitchEnter</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_topology_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;交换机上线时，添加到图中&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">switch_list = get_switch(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">switches = [switch.dp.<span class="built_in">id</span> <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_nodes_from(switches)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;Current Switches:&quot;, switches)</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventLinkAdd</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_link_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;链路发现时，添加到图中&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">links_list = get_link(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除旧边，重新添加，确保图是最新的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># self.net.clear_edges() # 视情况可选择是否全清</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.src.dpid, link.dst.dpid, port=link.src.port_no)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.dst.dpid, link.src.dpid, port=link.dst.port_no)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;Link Added. Current Edges:&quot;, self.net.edges())</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 核心逻辑部分 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">msg = ev.msg</span><br><span class="line"></span><br><span class="line">datapath = msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">dpid = datapath.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">pkt = packet.Packet(msg.data)</span><br><span class="line"></span><br><span class="line">eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 LLDP 和 IPv6 组播 (避免干扰和之前的风暴)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_LLDP:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_IPV6:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">dst = eth.dst</span><br><span class="line"></span><br><span class="line">src = eth.src</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 学习源 MAC 位置</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port.setdefault(dpid, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port[dpid][src] = in_port</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将主机视为图中的节点 (可选，为了计算路径方便)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> src <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_node(src)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(dpid, src, port=in_port)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(src, dpid) <span class="comment"># 双向连接</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 处理 ARP (实现 ARP 代理，核心防风暴逻辑)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_ARP:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.handle_arp(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 处理 IP 数据包 (最短路径转发)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果目的 MAC 在图中 (之前学过)，计算最短路径</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.compute_shortest_path(msg, src, dst, dpid, in_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果完全未知，只能泛洪 (在有环路且没有STP时这步有风险，</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 但因为我们拦截了ARP，大部分未知单播不会造成持续风暴)</span></span><br><span class="line"></span><br><span class="line">out_port = ofproto.OFPP_FLOOD</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line">data = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line"></span><br><span class="line">data = msg.data</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_arp</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;ARP 代理逻辑：如果控制器知道 IP 对应的 MAC，直接回复，不泛洪&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">arp_pkt = pkt.get_protocol(arp.arp)</span><br><span class="line"></span><br><span class="line">src_ip = arp_pkt.src_ip</span><br><span class="line"></span><br><span class="line">src_mac = arp_pkt.src_mac</span><br><span class="line"></span><br><span class="line">dst_ip = arp_pkt.dst_ip</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录 IP-MAC 映射</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table[src_ip] = src_mac</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arp_pkt.opcode == arp.ARP_REQUEST:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst_ip <span class="keyword">in</span> <span class="variable language_">self</span>.arp_table:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命中缓存！控制器构造 ARP Reply 发回去</span></span><br><span class="line"></span><br><span class="line">dst_mac = <span class="variable language_">self</span>.arp_table[dst_ip]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.send_arp_reply(datapath, in_port, src_mac, src_ip, dst_mac, dst_ip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没命中，必须泛洪 (FLOOD)，让目标主机收到</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里可能会有短暂的环路，但一旦收到 Reply，后续就不再泛洪</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> arp_pkt.opcode == arp.ARP_REPLY:</span><br><span class="line"></span><br><span class="line"><span class="comment"># ARP Reply 是单播，直接转发即可，或者让 shortest_path 处理</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_arp_reply</span>(<span class="params">self, datapath, port, src_mac, src_ip, dst_mac, dst_ip</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;构造并发送 ARP Reply&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">pkt = packet.Packet()</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(ethernet.ethernet(ethertype=ether_types.ETH_TYPE_ARP,</span><br><span class="line"></span><br><span class="line">dst=src_mac, src=dst_mac))</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(arp.arp(opcode=arp.ARP_REPLY,</span><br><span class="line"></span><br><span class="line">src_mac=dst_mac, src_ip=dst_ip,</span><br><span class="line"></span><br><span class="line">dst_mac=src_mac, dst_ip=src_ip))</span><br><span class="line"></span><br><span class="line">pkt.serialize()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(port)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flood</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_shortest_path</span>(<span class="params">self, msg, src, dst, dpid, in_port</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;使用 NetworkX 计算最短路径并下发流表&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">datapath = msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在图中计算 src 到 dst 的路径: [src_mac, switch1, switch2, ..., dst_mac]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">path = nx.shortest_path(<span class="variable language_">self</span>.net, src, dst)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前交换机在路径中的位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># path 结构示例: [&#x27;h1_mac&#x27;, 1, 2, 3, &#x27;h3_mac&#x27;] (假设 dpid 是整数)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到当前 switch dpid 在 path 中的下一跳</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dpid <span class="keyword">not</span> <span class="keyword">in</span> path:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">next_hop = path[path.index(dpid) + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">out_port = <span class="variable language_">self</span>.net[dpid][next_hop][<span class="string">&#x27;port&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下发流表：匹配 (src, dst) -&gt; output: out_port</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch(in_port=in_port, eth_dst=dst, eth_src=src)</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里的 packet_out 已经在 add_flow 里被处理吗？不，packet_out 还是需要的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 buffer_id 是有效值，add_flow 会自动处理发包；如果不是，需要手动发</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=msg.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> nx.NetworkXNoPath:</span><br><span class="line"></span><br><span class="line"><span class="keyword">pass</span> <span class="comment"># 路径不可达</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Path Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>动态负载平衡 dynamic_load_balance.py</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># dynamic_load_balance.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> CONFIG_DISPATCHER, MAIN_DISPATCHER, DEAD_DISPATCHER</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib <span class="keyword">import</span> hub</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet, ethernet, arp, ether_types</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DynamicLoadBalance</span>(app_manager.RyuApp):</span><br><span class="line"></span><br><span class="line">OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line"><span class="built_in">super</span>(DynamicLoadBalance, <span class="variable language_">self</span>).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net = nx.DiGraph()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.datapaths = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 监控相关变量 ---</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.monitor_thread = hub.spawn(<span class="variable language_">self</span>._monitor) <span class="comment"># 开启监控线程</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_stats = &#123;&#125; <span class="comment"># 保存上一秒的统计信息 &#123;(dpid, port): (bytes, timestamp)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_speed = &#123;&#125; <span class="comment"># 保存计算出的速率</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.THRESHOLD = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1</span> <span class="comment"># 阈值：1 MB/s (为了测试方便设得较低)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.DEFAULT_WEIGHT = <span class="number">1</span> <span class="comment"># 默认链路权重</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.CONGESTED_WEIGHT = <span class="number">100</span> <span class="comment"># 拥堵链路权重</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPStateChange, [MAIN_DISPATCHER, DEAD_DISPATCHER]</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_state_change_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">datapath = ev.datapath</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ev.state == MAIN_DISPATCHER:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> datapath.<span class="built_in">id</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.datapaths:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.datapaths[datapath.<span class="built_in">id</span>] = datapath</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> ev.state == DEAD_DISPATCHER:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> datapath.<span class="built_in">id</span> <span class="keyword">in</span> <span class="variable language_">self</span>.datapaths:</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> <span class="variable language_">self</span>.datapaths[datapath.<span class="built_in">id</span>]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">datapath = ev.msg.datapath</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS, actions)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> buffer_id:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line"></span><br><span class="line">priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 监控逻辑 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_monitor</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;每隔 3 秒向所有交换机请求端口统计信息&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dp <span class="keyword">in</span> <span class="variable language_">self</span>.datapaths.values():</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>._request_stats(dp)</span><br><span class="line"></span><br><span class="line">hub.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_request_stats</span>(<span class="params">self, datapath</span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">req = parser.OFPPortStatsRequest(datapath, <span class="number">0</span>, ofproto.OFPP_ANY)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(req)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPPortStatsReply, MAIN_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_port_stats_reply_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">body = ev.msg.body</span><br><span class="line"></span><br><span class="line">dpid = ev.msg.datapath.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> stat <span class="keyword">in</span> body:</span><br><span class="line"></span><br><span class="line">port_no = stat.port_no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略 LOCAL 端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> port_no &gt; <span class="number">1000</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">key = (dpid, port_no)</span><br><span class="line"></span><br><span class="line">tmp_bytes = stat.tx_bytes + stat.rx_bytes <span class="comment"># 统计收发总流量</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> key <span class="keyword">in</span> <span class="variable language_">self</span>.port_stats:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算速率：(当前字节 - 上次字节) / 时间间隔(这里约等于 sleep 时间)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 简化处理，直接看增量</span></span><br><span class="line"></span><br><span class="line">prev_bytes = <span class="variable language_">self</span>.port_stats[key]</span><br><span class="line"></span><br><span class="line">speed = (tmp_bytes - prev_bytes) / <span class="number">3.0</span> <span class="comment"># byte/s</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_speed[key] = speed</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 动态调整权重 ---</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>._adjust_link_weight(dpid, port_no, speed)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新记录</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.port_stats[key] = tmp_bytes</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_adjust_link_weight</span>(<span class="params">self, dpid, port_no, speed</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;如果流量超过阈值，增加图中对应边的权重&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到该端口连接的邻居节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里需要遍历图来找到 (u, v) 其中 u=dpid 且 port=port_no</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> u, v, data <span class="keyword">in</span> <span class="variable language_">self</span>.net.edges(data=<span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> u == dpid <span class="keyword">and</span> data[<span class="string">&#x27;port&#x27;</span>] == port_no:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否超过阈值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> speed &gt; <span class="variable language_">self</span>.THRESHOLD:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> data[<span class="string">&#x27;weight&#x27;</span>] == <span class="variable language_">self</span>.DEFAULT_WEIGHT:</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;!!! 拥塞告警 [Switch <span class="subst">&#123;dpid&#125;</span> Port <span class="subst">&#123;port_no&#125;</span>] 速率: <span class="subst">&#123;speed/<span class="number">1024</span>:<span class="number">.2</span>f&#125;</span> KB/s. 切换线路!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net[u][v][<span class="string">&#x27;weight&#x27;</span>] = <span class="variable language_">self</span>.CONGESTED_WEIGHT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除旧流表，强制重新寻路</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.del_flow(<span class="variable language_">self</span>.datapaths[dpid], port_no)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 流量恢复正常，恢复权重</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> data[<span class="string">&#x27;weight&#x27;</span>] == <span class="variable language_">self</span>.CONGESTED_WEIGHT:</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;*** 拥塞解除 [Switch <span class="subst">&#123;dpid&#125;</span> Port <span class="subst">&#123;port_no&#125;</span>]. 恢复默认线路.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net[u][v][<span class="string">&#x27;weight&#x27;</span>] = <span class="variable language_">self</span>.DEFAULT_WEIGHT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选：也删除流表让流量切回来（或者等流表自然超时）</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.del_flow(<span class="variable language_">self</span>.datapaths[dpid], port_no)</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_flow</span>(<span class="params">self, datapath, out_port</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;删除指定输出端口的流表，迫使下一包触发 Packet-In 重新计算路径&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch() <span class="comment"># 也可以更精确匹配，这里为了演示简单直接删掉该端口所有相关的流</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里删除的是 action 输出到 out_port 的流，Ryu 标准库 match 不能直接匹配 out_port action</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际操作：通常我们删除所有流或者让流表由 idle_timeout 自动老化。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了演示效果，我们发送一个删除指令，匹配所有包</span></span><br><span class="line"></span><br><span class="line">mod = parser.OFPFlowMod(datapath=datapath, command=ofproto.OFPFC_DELETE,</span><br><span class="line"></span><br><span class="line">out_port=out_port, out_group=ofproto.OFPG_ANY,</span><br><span class="line"></span><br><span class="line">priority=<span class="number">1</span>, <span class="keyword">match</span>=<span class="keyword">match</span>)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------------- 拓扑与转发逻辑 -------------------</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventSwitchEnter</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_topology_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">switch_list = get_switch(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">switches = [switch.dp.<span class="built_in">id</span> <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_nodes_from(switches)</span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">event.EventLinkAdd</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_link_data</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">links_list = get_link(<span class="variable language_">self</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化权重为 1</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.src.dpid, link.dst.dpid,</span><br><span class="line"></span><br><span class="line">port=link.src.port_no, weight=<span class="variable language_">self</span>.DEFAULT_WEIGHT)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(link.dst.dpid, link.src.dpid,</span><br><span class="line"></span><br><span class="line">port=link.dst.port_no, weight=<span class="variable language_">self</span>.DEFAULT_WEIGHT)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">@set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line"></span><br><span class="line">msg = ev.msg</span><br><span class="line"></span><br><span class="line">datapath = msg.datapath</span><br><span class="line"></span><br><span class="line">dpid = datapath.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pkt = packet.Packet(msg.data)</span><br><span class="line"></span><br><span class="line">eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_LLDP <span class="keyword">or</span> eth.ethertype == ether_types.ETH_TYPE_IPV6:</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">dst = eth.dst</span><br><span class="line"></span><br><span class="line">src = eth.src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拓扑学习：记录主机位置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> src <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_node(src)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(dpid, src, port=in_port, weight=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.net.add_edge(src, dpid, weight=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理 ARP</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eth.ethertype == ether_types.ETH_TYPE_ARP:</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.handle_arp(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理 IP 转发 (核心：带权重的最短路径)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst <span class="keyword">in</span> <span class="variable language_">self</span>.net:</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># weight=&#x27;weight&#x27; 告诉算法考虑我们动态调整的拥塞权重</span></span><br><span class="line"></span><br><span class="line">path = nx.shortest_path(<span class="variable language_">self</span>.net, src, dst, weight=<span class="string">&#x27;weight&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dpid <span class="keyword">not</span> <span class="keyword">in</span> path: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">next_hop = path[path.index(dpid) + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">out_port = <span class="variable language_">self</span>.net[dpid][next_hop][<span class="string">&#x27;port&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = parser.OFPMatch(in_port=in_port, eth_dst=dst, eth_src=src)</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># idle_timeout=5: 设短一点，方便快速适应网络变化</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> msg.buffer_id == datapath.ofproto.OFP_NO_BUFFER:</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=msg.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (复用之前的 handle_arp 和 add_flow 辅助函数，此处省略未变部分以节省空间，请补全)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 务必将之前的 handle_arp, send_arp_reply, flood 函数复制过来放到这里</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_arp</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;ARP 代理逻辑：如果控制器知道 IP 对应的 MAC，直接回复，不泛洪&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">arp_pkt = pkt.get_protocol(arp.arp)</span><br><span class="line"></span><br><span class="line">src_ip = arp_pkt.src_ip</span><br><span class="line"></span><br><span class="line">src_mac = arp_pkt.src_mac</span><br><span class="line"></span><br><span class="line">dst_ip = arp_pkt.dst_ip</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录 IP-MAC 映射</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.arp_table[src_ip] = src_mac</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arp_pkt.opcode == arp.ARP_REQUEST:</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> dst_ip <span class="keyword">in</span> <span class="variable language_">self</span>.arp_table:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命中缓存！控制器构造 ARP Reply 发回去</span></span><br><span class="line"></span><br><span class="line">dst_mac = <span class="variable language_">self</span>.arp_table[dst_ip]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.send_arp_reply(datapath, in_port, src_mac, src_ip, dst_mac, dst_ip)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没命中，必须泛洪 (FLOOD)，让目标主机收到</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这里可能会有短暂的环路，但一旦收到 Reply，后续就不再泛洪</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> arp_pkt.opcode == arp.ARP_REPLY:</span><br><span class="line"></span><br><span class="line"><span class="comment"># ARP Reply 是单播，直接转发即可，或者让 shortest_path 处理</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">self</span>.flood(datapath, in_port, pkt)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_arp_reply</span>(<span class="params">self, datapath, port, src_mac, src_ip, dst_mac, dst_ip</span>):</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;构造并发送 ARP Reply&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">pkt = packet.Packet()</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(ethernet.ethernet(ethertype=ether_types.ETH_TYPE_ARP,</span><br><span class="line"></span><br><span class="line">dst=src_mac, src=dst_mac))</span><br><span class="line"></span><br><span class="line">pkt.add_protocol(arp.arp(opcode=arp.ARP_REPLY,</span><br><span class="line"></span><br><span class="line">src_mac=dst_mac, src_ip=dst_ip,</span><br><span class="line"></span><br><span class="line">dst_mac=src_mac, dst_ip=src_ip))</span><br><span class="line"></span><br><span class="line">pkt.serialize()</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(port)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=ofproto.OFPP_CONTROLLER,</span><br><span class="line"></span><br><span class="line">actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flood</span>(<span class="params">self, datapath, in_port, pkt</span>):</span><br><span class="line"></span><br><span class="line">ofproto = datapath.ofproto</span><br><span class="line"></span><br><span class="line">parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">actions = [parser.OFPActionOutput(ofproto.OFPP_FLOOD)]</span><br><span class="line"></span><br><span class="line">out = parser.OFPPacketOut(datapath=datapath, buffer_id=ofproto.OFP_NO_BUFFER,</span><br><span class="line"></span><br><span class="line">in_port=in_port, actions=actions, data=pkt.data)</span><br><span class="line"></span><br><span class="line">datapath.send_msg(out)</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://world.jellylove.cfd">jelly</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://world.jellylove.cfd/2026/01/12/sdn/">http://world.jellylove.cfd/2026/01/12/sdn/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://world.jellylove.cfd" target="_blank">jelly's 小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/study/">study</a></div><div class="post-share"><div class="social-share" data-image="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/13/2026-1-13/" title="爱 ，生命，自由，金钱"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">爱 ，生命，自由，金钱</div></div><div class="info-2"><div class="info-item-1">发现不刷抖音，我也不会想那么多了，有些事太远了，想太多也没什么用，不如把当前的事做好，其实不是我不想放弃自己的思考，只是我还没有能力控制好自己的偏见，思考太多只会更加加深自己的偏见，对身边的人产生伤害，我不想变成“神”了，我只想好好过好自己的人生就行，普通人生也行，家人们无病无灾，我身体健健康康，烦恼少一点，朋友多一点，爱好再多一点，人生支柱再多一点，每天都创造一点价值感，如果运气比较好的话，那就是找个我爱的人和爱我的人度过余生，不奢求。如果真能有这样的人生，想想真好啊，这也许就是理想幸福人生吧，我必须积极一点，其实现在我也是幸福的，我想要每一天都会开开心心的。这也许也是她想的，我现在觉得这种现实并且最平凡的生活，才是最珍贵的也是最难的。会的，我以后一定会实现的，相信自己。我也不会在要求别人相信自己了，自己相信自己更重要！题外话问题：“自由 爱情 财富 生命，用你的价值观对这些进行排序，越看重的排越前面”对于这个问题答案，我曾经在抖音评论区写过，这里就直接搬过来了（那个视频是对infp提问的，这里就不给自己贴标签了，就是对我这个性格而言和价值观而言）回答都具有时效性，现在的回答只...</div></div></div></a><a class="pagination-related" href="/2026/01/12/2026-1-12/" title="applemusic-dl"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">applemusic-dl</div></div><div class="info-2"><div class="info-item-1">使用的是开源项目 https://github.com/hatimalu/AppleMusic_downloader?tab=readme-ov-file 我现在使用的系统是macos sequoia15.7主要看的是这篇教程 https://applemusic.mintlify.app/amdl/quickstart/macos 但其中的第一步的操作改成如下操作  #开发工具及图形化 Dockerbrew install go gpac git &amp;&amp; brew install --cask docker &amp;&amp; git clone https://github.com/zhaarey/apple-music-downloader.git  然后就安装引用教程操作即可  win端推荐一个本地音乐播放器 建议购买steam版本（以后使用创意工坊更简单）https://moriafly.com/program/spw.html  本项目 歌词下载有bug，已用ai修复 问题原因在处理 TTML 格式的歌词时，代码假设某些 XML 元素一定存在，但实际上...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/12/27/bezier/" title="sdn实验"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-27</div><div class="info-item-2">sdn实验</div></div><div class="info-2"><div class="info-item-1">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172# 1. 导入相关的依赖from mininet.net import Mininetfrom mininet.node import Controller, RemoteController, OVSControllerfrom mininet.node import CPULimitedHost, Host, Nodefrom mininet.node import OVSKernelSwitch, UserSwitchfrom mininet.node import IVSSwitchfrom mininet.cli import CLIfrom mininet.log import setLogLevel, infofrom mininet.link import TCLink, Intffrom subp...</div></div></div></a><a class="pagination-related" href="/2025/12/27/study-plan/" title="学习日记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-27</div><div class="info-item-2">学习日记</div></div><div class="info-2"><div class="info-item-1"> 前言即将进入期末考试阶段，我以这篇博客，作为自己期末复习日记，督促自己完成的复习计划本人是拖延症晚期患者，也想通过这样的方式改善自己的毛病，像更好的自己前进✍️  结业科目列表 计算机网络 概念学习 代码学习 结业考试   计算机操作系统 实验概念学习 结业考试   人工智能 项目 结业考试   计算机图形学 项目答辩   智能媒体技术 自主学习 结业考试     日记12月27 周六完成计算机图形学 贝塞尔曲线实验作业报告 12月28 周日复习计算机操作系统进度5%啥也没学，玩了一天（让我忏悔5分钟但王麻子这集问鼎真不错，唢呐卡点好爽😄推荐一下今日歌曲，《连名带姓》张惠妹唱的非常不错，周杰伦作曲 1月7日 周三操作系统复习20%练习一会英语听力《橙月》这张专辑真的太喜欢了，纯爱狂喜。有生之年等实体专辑不炒这么高了，一定要入一张，可惜相逢甚晚 </div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">jelly</div><div class="author-info-description">记录生活点滴，分享技术知识，记录成长轨迹</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/18/2026-1-17/" title="Sorry and Goodbye"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Sorry and Goodbye"/></a><div class="content"><a class="title" href="/2026/01/18/2026-1-17/" title="Sorry and Goodbye">Sorry and Goodbye</a><time datetime="2026-01-17T16:42:56.000Z" title="发表于 2026-01-18 00:42:56">2026-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/16/2026-1-16/" title="悲伤上瘾"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://image.jellylove.cfd/PicGo/wallhaven-8oywp2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="悲伤上瘾"/></a><div class="content"><a class="title" href="/2026/01/16/2026-1-16/" title="悲伤上瘾">悲伤上瘾</a><time datetime="2026-01-16T12:18:23.000Z" title="发表于 2026-01-16 20:18:23">2026-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/16/%E6%9C%AA%E5%91%BD%E5%90%8D%201/" title="无标题">无标题</a><time datetime="2026-01-16T01:40:51.891Z" title="发表于 2026-01-16 09:40:51">2026-01-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/15/Excalidraw/Drawing%202026-01-15%2015.28.37.excalidraw/" title="无标题">无标题</a><time datetime="2026-01-15T07:28:37.095Z" title="发表于 2026-01-15 15:28:37">2026-01-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/15/2026-01-15/" title="无标题">无标题</a><time datetime="2026-01-15T07:28:01.652Z" title="发表于 2026-01-15 15:28:01">2026-01-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By jelly</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@latest/Hexo/js/mouse_snow.min.js"></script><div class="aplayer no-destroy" data-id="17633723458" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>